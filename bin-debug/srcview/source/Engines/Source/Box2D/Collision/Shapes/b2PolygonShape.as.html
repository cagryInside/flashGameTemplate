<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>b2PolygonShape.as</title>
<link rel="stylesheet" type="text/css" href="../../../../../../SourceStyles.css"/>
</head>

<body><pre><span class="ActionScriptComment">/*
* Copyright (c) 2006-2007 Erin Catto http://www.gphysics.com
*
* This software is provided 'as-is', without any express or implied
* warranty.  In no event will the authors be held liable for any damages
* arising from the use of this software.
* Permission is granted to anyone to use this software for any purpose,
* including commercial applications, and to alter it and redistribute it
* freely, subject to the following restrictions:
* 1. The origin of this software must not be misrepresented; you must not
* claim that you wrote the original software. If you use this software
* in a product, an acknowledgment in the product documentation would be
* appreciated but is not required.
* 2. Altered source versions must be plainly marked as such, and must not be
* misrepresented as being the original software.
* 3. This notice may not be removed or altered from any source distribution.
*/</span>

<span class="ActionScriptpackage">package</span> <span class="ActionScriptDefault_Text">Box2D</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Collision</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Shapes</span><span class="ActionScriptBracket/Brace">{</span>

<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">Box2D</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Common</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">*</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">Box2D</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Common</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">*</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">Box2D</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Collision</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Shapes</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">*</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">Box2D</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Dynamics</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">*</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">Box2D</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Collision</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">*</span>;

<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">Box2D</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Common</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">b2internal</span>;
<span class="ActionScriptReserved">use</span> <span class="ActionScriptReserved">namespace</span> <span class="ActionScriptDefault_Text">b2internal</span>;

<span class="ActionScriptASDoc">/**
* Convex polygon. The vertices must be in CCW order for a right-handed
* coordinate system with the z-axis coming out of the screen.
* @see b2PolygonDef
*/</span>

<span class="ActionScriptReserved">public</span> <span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">b2PolygonShape</span> <span class="ActionScriptReserved">extends</span> <span class="ActionScriptDefault_Text">b2Shape</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">Copy</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">b2Shape</span> 
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">s</span>:<span class="ActionScriptDefault_Text">b2PolygonShape</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">b2PolygonShape</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">s</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Set</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">s</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">Set</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">other</span>:<span class="ActionScriptDefault_Text">b2Shape</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span> 
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">super</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Set</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">other</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">other</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">b2PolygonShape</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">other2</span>:<span class="ActionScriptDefault_Text">b2PolygonShape</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">other</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">b2PolygonShape</span>;
            <span class="ActionScriptDefault_Text">m_centroid</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetV</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">other2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_centroid</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">m_vertexCount</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">other2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_vertexCount</span>;
            <span class="ActionScriptDefault_Text">Reserve</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_vertexCount</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">m_vertexCount</span>; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetV</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">other2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">m_normals</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetV</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">other2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_normals</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>
    
    <span class="ActionScriptASDoc">/**
     * Copy vertices. This assumes the vertices define a convex polygon.
     * It is assumed that the exterior is the the right of each edge.
     */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">SetAsArray</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vertices</span>:<span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">vertexCount</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0<span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">v</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">&gt;</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">for each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tVec</span>:<span class="ActionScriptDefault_Text">b2Vec2</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">v</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tVec</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptDefault_Text">SetAsVector</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">vertexCount</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">AsArray</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vertices</span>:<span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">vertexCount</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">b2PolygonShape</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">polygonShape</span>:<span class="ActionScriptDefault_Text">b2PolygonShape</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">b2PolygonShape</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">polygonShape</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetAsArray</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">vertexCount</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">polygonShape</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    
    <span class="ActionScriptASDoc">/**
     * Copy vertices. This assumes the vertices define a convex polygon.
     * It is assumed that the exterior is the the right of each edge.
     */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">SetAsVector</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vertices</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">vertexCount</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0<span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vertexCount</span> <span class="ActionScriptOperator">==</span> 0<span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptDefault_Text">vertexCount</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span>;
            
        <span class="ActionScriptDefault_Text">b2Settings</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">b2Assert</span><span class="ActionScriptBracket/Brace">(</span>2 <span class="ActionScriptOperator">&lt;=</span> <span class="ActionScriptDefault_Text">vertexCount</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">m_vertexCount</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vertexCount</span>;
        
        <span class="ActionScriptDefault_Text">Reserve</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vertexCount</span><span class="ActionScriptBracket/Brace">)</span>;
        
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span>;
        
        <span class="ActionScriptComment">// Copy vertices
</span>        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">m_vertexCount</span>; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetV</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptComment">// Compute normals. Ensure the edges have non-zero length.
</span>        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">m_vertexCount</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i1</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i2</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">+</span> 1 <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">m_vertexCount</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">+</span> 1 : 0;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">edge</span>:<span class="ActionScriptDefault_Text">b2Vec2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">b2Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SubtractVV</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i1</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">b2Settings</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">b2Assert</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">edge</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">LengthSquared</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&gt;</span> <span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MIN_VALUE</span> <span class="ActionScriptComment">/* * Number.MIN_VALUE*/</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">m_normals</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetV</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">b2Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">CrossVF</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">edge</span><span class="ActionScriptOperator">,</span> 1.0<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">m_normals</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Normalize</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
<span class="ActionScriptComment">//#ifdef _DEBUG
</span>        <span class="ActionScriptComment">// Ensure the polygon is convex and the interior
</span>        <span class="ActionScriptComment">// is to the left of each edge.
</span>        <span class="ActionScriptComment">//for (int32 i = 0; i &lt; m_vertexCount; ++i)
</span>        <span class="ActionScriptComment">//{
</span>            <span class="ActionScriptComment">//int32 i1 = i;
</span>            <span class="ActionScriptComment">//int32 i2 = i + 1 &lt; m_vertexCount ? i + 1 : 0;
</span>            <span class="ActionScriptComment">//b2Vec2 edge = m_vertices[i2] - m_vertices[i1];
</span>            <span class="ActionScriptComment">//for (int32 j = 0; j &lt; m_vertexCount; ++j)
</span>            <span class="ActionScriptComment">//{
</span>                <span class="ActionScriptComment">// Don't check vertices on the current edge.
</span>                <span class="ActionScriptComment">//if (j == i1 || j == i2)
</span>                <span class="ActionScriptComment">//{
</span>                    <span class="ActionScriptComment">//continue;
</span>                <span class="ActionScriptComment">//}
</span>                <span class="ActionScriptComment">//
</span>                <span class="ActionScriptComment">//b2Vec2 r = m_vertices[j] - m_vertices[i1];
</span>                <span class="ActionScriptComment">// Your polygon is non-convex (it has an indentation) or
</span>                <span class="ActionScriptComment">// has colinear edges.
</span>                <span class="ActionScriptComment">//float32 s = b2Cross(edge, r);
</span>                <span class="ActionScriptComment">//b2Assert(s &gt; 0.0f);
</span>            <span class="ActionScriptComment">//}
</span>        <span class="ActionScriptComment">//}
</span><span class="ActionScriptComment">//#endif
</span>
        <span class="ActionScriptComment">// Compute the polygon centroid
</span>        <span class="ActionScriptDefault_Text">m_centroid</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ComputeCentroid</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">m_vertexCount</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">AsVector</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vertices</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">vertexCount</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">b2PolygonShape</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">polygonShape</span>:<span class="ActionScriptDefault_Text">b2PolygonShape</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">b2PolygonShape</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">polygonShape</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetAsVector</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">vertexCount</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">polygonShape</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    
    <span class="ActionScriptASDoc">/**
    * Build vertices to represent an axis-aligned box.
    * @param hx the half-width.
    * @param hy the half-height.
    */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">SetAsBox</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">hx</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">hy</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span> 
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">m_vertexCount</span> <span class="ActionScriptOperator">=</span> 4;
        <span class="ActionScriptDefault_Text">Reserve</span><span class="ActionScriptBracket/Brace">(</span>4<span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Set</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">hx</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">hy</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Set</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">hx</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">hy</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Set</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">hx</span><span class="ActionScriptOperator">,</span>  <span class="ActionScriptDefault_Text">hy</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span>3<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Set</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">hx</span><span class="ActionScriptOperator">,</span>  <span class="ActionScriptDefault_Text">hy</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">m_normals</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Set</span><span class="ActionScriptBracket/Brace">(</span>0.0<span class="ActionScriptOperator">,</span> <span class="ActionScriptOperator">-</span>1.0<span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">m_normals</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Set</span><span class="ActionScriptBracket/Brace">(</span>1.0<span class="ActionScriptOperator">,</span> 0.0<span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">m_normals</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Set</span><span class="ActionScriptBracket/Brace">(</span>0.0<span class="ActionScriptOperator">,</span> 1.0<span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">m_normals</span><span class="ActionScriptBracket/Brace">[</span>3<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Set</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span>1.0<span class="ActionScriptOperator">,</span> 0.0<span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">m_centroid</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetZero</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">AsBox</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">hx</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">hy</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">b2PolygonShape</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">polygonShape</span>:<span class="ActionScriptDefault_Text">b2PolygonShape</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">b2PolygonShape</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">polygonShape</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetAsBox</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">hx</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">hy</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">polygonShape</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    
    <span class="ActionScriptASDoc">/**
    * Build vertices to represent an oriented box.
    * @param hx the half-width.
    * @param hy the half-height.
    * @param center the center of the box in local coordinates.
    * @param angle the rotation of the box in local coordinates.
    */</span>
    <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">s_mat</span>:<span class="ActionScriptDefault_Text">b2Mat22</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">b2Mat22</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">SetAsOrientedBox</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">hx</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">hy</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">center</span>:<span class="ActionScriptDefault_Text">b2Vec2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">angle</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0.0<span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">m_vertexCount</span> <span class="ActionScriptOperator">=</span> 4;
        <span class="ActionScriptDefault_Text">Reserve</span><span class="ActionScriptBracket/Brace">(</span>4<span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Set</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">hx</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">hy</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Set</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">hx</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">hy</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Set</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">hx</span><span class="ActionScriptOperator">,</span>  <span class="ActionScriptDefault_Text">hy</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span>3<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Set</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">hx</span><span class="ActionScriptOperator">,</span>  <span class="ActionScriptDefault_Text">hy</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">m_normals</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Set</span><span class="ActionScriptBracket/Brace">(</span>0.0<span class="ActionScriptOperator">,</span> <span class="ActionScriptOperator">-</span>1.0<span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">m_normals</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Set</span><span class="ActionScriptBracket/Brace">(</span>1.0<span class="ActionScriptOperator">,</span> 0.0<span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">m_normals</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Set</span><span class="ActionScriptBracket/Brace">(</span>0.0<span class="ActionScriptOperator">,</span> 1.0<span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">m_normals</span><span class="ActionScriptBracket/Brace">[</span>3<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Set</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span>1.0<span class="ActionScriptOperator">,</span> 0.0<span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">m_centroid</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">center</span>;

        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">xf</span>:<span class="ActionScriptDefault_Text">b2Transform</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">b2Transform</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">xf</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">position</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">center</span>;
        <span class="ActionScriptDefault_Text">xf</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">R</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Set</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">angle</span><span class="ActionScriptBracket/Brace">)</span>;

        <span class="ActionScriptComment">// Transform vertices and normals.
</span>        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">m_vertexCount</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">b2Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MulX</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">xf</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">m_normals</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">b2Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MulMV</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">xf</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">R</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">m_normals</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>
    
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">AsOrientedBox</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">hx</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">hy</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">center</span>:<span class="ActionScriptDefault_Text">b2Vec2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">angle</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0.0<span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">b2PolygonShape</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">polygonShape</span>:<span class="ActionScriptDefault_Text">b2PolygonShape</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">b2PolygonShape</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">polygonShape</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetAsOrientedBox</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">hx</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">hy</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">center</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">angle</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">polygonShape</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    
    <span class="ActionScriptASDoc">/**
     * Set this as a single edge.
     */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">SetAsEdge</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v1</span>:<span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">v2</span>:<span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">m_vertexCount</span> <span class="ActionScriptOperator">=</span> 2;
        <span class="ActionScriptDefault_Text">Reserve</span><span class="ActionScriptBracket/Brace">(</span>2<span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetV</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v1</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetV</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v2</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">m_centroid</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> 0.5 <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">v2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">m_centroid</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> 0.5 <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">v2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">m_normals</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">b2Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">CrossVF</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">b2Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SubtractVV</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v2</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">v1</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">,</span> 1.0<span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">m_normals</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Normalize</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">m_normals</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">m_normals</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
        <span class="ActionScriptDefault_Text">m_normals</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">m_normals</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    
    <span class="ActionScriptASDoc">/**
     * Set this as a single edge.
     */</span>
    <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">AsEdge</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v1</span>:<span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">v2</span>:<span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">b2PolygonShape</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">polygonShape</span>:<span class="ActionScriptDefault_Text">b2PolygonShape</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">b2PolygonShape</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">polygonShape</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetAsEdge</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v1</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">v2</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">polygonShape</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    
    
    <span class="ActionScriptASDoc">/**
    * @inheritDoc
    */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">TestPoint</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">xf</span>:<span class="ActionScriptDefault_Text">b2Transform</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">p</span>:<span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tVec</span>:<span class="ActionScriptDefault_Text">b2Vec2</span>;
        
        <span class="ActionScriptComment">//b2Vec2 pLocal = b2MulT(xf.R, p - xf.position);
</span>        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tMat</span>:<span class="ActionScriptDefault_Text">b2Mat22</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">xf</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">R</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">xf</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">position</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tY</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">xf</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">position</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pLocalX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tX</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tY</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pLocalY</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tX</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tY</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span>;
        
        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">m_vertexCount</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">//float32 dot = b2Dot(m_normals[i], pLocal - m_vertices[i]);
</span>            <span class="ActionScriptDefault_Text">tVec</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptDefault_Text">tX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">pLocalX</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">tVec</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
            <span class="ActionScriptDefault_Text">tY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">pLocalY</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">tVec</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
            <span class="ActionScriptDefault_Text">tVec</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_normals</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dot</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tVec</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">tX</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tVec</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">tY</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dot</span> <span class="ActionScriptOperator">&gt;</span> 0.0<span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">true</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptASDoc">/**
     * @inheritDoc
     */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">RayCast</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">output</span>:<span class="ActionScriptDefault_Text">b2RayCastOutput</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">input</span>:<span class="ActionScriptDefault_Text">b2RayCastInput</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">transform</span>:<span class="ActionScriptDefault_Text">b2Transform</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Boolean</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">lower</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0.0;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">upper</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">input</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">maxFraction</span>;
        
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tX</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tY</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tMat</span>:<span class="ActionScriptDefault_Text">b2Mat22</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tVec</span>:<span class="ActionScriptDefault_Text">b2Vec2</span>;
        
        <span class="ActionScriptComment">// Put the ray into the polygon's frame of reference. (AS3 Port Manual inlining follows)
</span>        <span class="ActionScriptComment">//b2Vec2 p1 = b2MulT(transform.R, segment.p1 - transform.position);
</span>        <span class="ActionScriptDefault_Text">tX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">input</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">p1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">transform</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">position</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
        <span class="ActionScriptDefault_Text">tY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">input</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">p1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">transform</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">position</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
        <span class="ActionScriptDefault_Text">tMat</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">transform</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">R</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">p1X</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tX</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tY</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">p1Y</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tX</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tY</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptComment">//b2Vec2 p2 = b2MulT(transform.R, segment.p2 - transform.position);
</span>        <span class="ActionScriptDefault_Text">tX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">input</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">p2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">transform</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">position</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
        <span class="ActionScriptDefault_Text">tY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">input</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">p2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">transform</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">position</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
        <span class="ActionScriptDefault_Text">tMat</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">transform</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">R</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">p2X</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tX</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tY</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">p2Y</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tX</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tY</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptComment">//b2Vec2 d = p2 - p1;
</span>        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p2X</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">p1X</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dY</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p2Y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">p1Y</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">index</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> -1;
        
        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">m_vertexCount</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">// p = p1 + a * d
</span>            <span class="ActionScriptComment">// dot(normal, p - v) = 0
</span>            <span class="ActionScriptComment">// dot(normal, p1 - v) + a * dot(normal, d) = 0
</span>            
            <span class="ActionScriptComment">//float32 numerator = b2Dot(m_normals[i], m_vertices[i] - p1);
</span>            <span class="ActionScriptDefault_Text">tVec</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptDefault_Text">tX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tVec</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">p1X</span>;
            <span class="ActionScriptDefault_Text">tY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tVec</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">p1Y</span>;
            <span class="ActionScriptDefault_Text">tVec</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_normals</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">numerator</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tVec</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">tX</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tVec</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">tY</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptComment">//float32 denominator = b2Dot(m_normals[i], d);
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">denominator</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tVec</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">dX</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tVec</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">dY</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">denominator</span> <span class="ActionScriptOperator">==</span> 0.0<span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">numerator</span> <span class="ActionScriptOperator">&lt;</span> 0.0<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// Note: we want this predicate without division:
</span>                <span class="ActionScriptComment">// lower &lt; numerator / denominator, where denominator &lt; 0
</span>                <span class="ActionScriptComment">// Since denominator &lt; 0, we have to flip the inequality:
</span>                <span class="ActionScriptComment">// lower &lt; numerator / denominator &lt;==&gt; denominator * lower &gt; numerator.
</span>                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">denominator</span> <span class="ActionScriptOperator">&lt;</span> 0.0 <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">numerator</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">lower</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">denominator</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">// Increase lower.
</span>                    <span class="ActionScriptComment">// The segment enters this half-space.
</span>                    <span class="ActionScriptDefault_Text">lower</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">numerator</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">denominator</span>;
                    <span class="ActionScriptDefault_Text">index</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">denominator</span> <span class="ActionScriptOperator">&gt;</span> 0.0 <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">numerator</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">upper</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">denominator</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">// Decrease upper.
</span>                    <span class="ActionScriptComment">// The segment exits this half-space.
</span>                    <span class="ActionScriptDefault_Text">upper</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">numerator</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">denominator</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">upper</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">lower</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MIN_VALUE</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptComment">//b2Settings.b2Assert(0.0 &lt;= lower &amp;&amp; lower &lt;= input.maxLambda);
</span>        
        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">index</span> <span class="ActionScriptOperator">&gt;=</span> 0<span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">output</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">fraction</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">lower</span>;
            <span class="ActionScriptComment">//output.normal = b2Mul(transform.R, m_normals[index]);
</span>            <span class="ActionScriptDefault_Text">tMat</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">transform</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">R</span>;
            <span class="ActionScriptDefault_Text">tVec</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_normals</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">index</span><span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptDefault_Text">output</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">normal</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">tVec</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">tVec</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">output</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">normal</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">tVec</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">tVec</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">true</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
    <span class="ActionScriptBracket/Brace">}</span>


    <span class="ActionScriptASDoc">/**
     * @inheritDoc
     */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">ComputeAABB</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">aabb</span>:<span class="ActionScriptDefault_Text">b2AABB</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">xf</span>:<span class="ActionScriptDefault_Text">b2Transform</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptComment">//var lower:b2Vec2 = b2Math.MulX(xf, m_vertices[0]);
</span>        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tMat</span>:<span class="ActionScriptDefault_Text">b2Mat22</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">xf</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">R</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tVec</span>:<span class="ActionScriptDefault_Text">b2Vec2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">lowerX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">xf</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">position</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">tVec</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">tVec</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">lowerY</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">xf</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">position</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">tVec</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">tVec</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">upperX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">lowerX</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">upperY</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">lowerY</span>;
        
        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 1; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">m_vertexCount</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">tVec</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">xf</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">position</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">tVec</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">tVec</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vY</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">xf</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">position</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">tVec</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">tVec</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">lowerX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">lowerX</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">vX</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">lowerX</span> : <span class="ActionScriptDefault_Text">vX</span>;
            <span class="ActionScriptDefault_Text">lowerY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">lowerY</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">vY</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">lowerY</span> : <span class="ActionScriptDefault_Text">vY</span>;
            <span class="ActionScriptDefault_Text">upperX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">upperX</span> <span class="ActionScriptOperator">&gt;</span> <span class="ActionScriptDefault_Text">vX</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">upperX</span> : <span class="ActionScriptDefault_Text">vX</span>;
            <span class="ActionScriptDefault_Text">upperY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">upperY</span> <span class="ActionScriptOperator">&gt;</span> <span class="ActionScriptDefault_Text">vY</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">upperY</span> : <span class="ActionScriptDefault_Text">vY</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptDefault_Text">aabb</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">lowerBound</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">lowerX</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">m_radius</span>;
        <span class="ActionScriptDefault_Text">aabb</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">lowerBound</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">lowerY</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">m_radius</span>;
        <span class="ActionScriptDefault_Text">aabb</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">upperBound</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">upperX</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">m_radius</span>;
        <span class="ActionScriptDefault_Text">aabb</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">upperBound</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">upperY</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">m_radius</span>;
    <span class="ActionScriptBracket/Brace">}</span>


    <span class="ActionScriptASDoc">/**
    * @inheritDoc
    */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">ComputeMass</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">massData</span>:<span class="ActionScriptDefault_Text">b2MassData</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">density</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span><span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptComment">// Polygon mass, centroid, and inertia.
</span>        <span class="ActionScriptComment">// Let rho be the polygon density in mass per unit area.
</span>        <span class="ActionScriptComment">// Then:
</span>        <span class="ActionScriptComment">// mass = rho * int(dA)
</span>        <span class="ActionScriptComment">// centroid.x = (1/mass) * rho * int(x * dA)
</span>        <span class="ActionScriptComment">// centroid.y = (1/mass) * rho * int(y * dA)
</span>        <span class="ActionScriptComment">// I = rho * int((x*x + y*y) * dA)
</span>        <span class="ActionScriptComment">//
</span>        <span class="ActionScriptComment">// We can compute these integrals by summing all the integrals
</span>        <span class="ActionScriptComment">// for each triangle of the polygon. To evaluate the integral
</span>        <span class="ActionScriptComment">// for a single triangle, we make a change of variables to
</span>        <span class="ActionScriptComment">// the (u,v) coordinates of the triangle:
</span>        <span class="ActionScriptComment">// x = x0 + e1x * u + e2x * v
</span>        <span class="ActionScriptComment">// y = y0 + e1y * u + e2y * v
</span>        <span class="ActionScriptComment">// where 0 &lt;= u &amp;&amp; 0 &lt;= v &amp;&amp; u + v &lt;= 1.
</span>        <span class="ActionScriptComment">//
</span>        <span class="ActionScriptComment">// We integrate u from [0,1-v] and then v from [0,1].
</span>        <span class="ActionScriptComment">// We also need to use the Jacobian of the transformation:
</span>        <span class="ActionScriptComment">// D = cross(e1, e2)
</span>        <span class="ActionScriptComment">//
</span>        <span class="ActionScriptComment">// Simplification: triangle centroid = (1/3) * (p1 + p2 + p3)
</span>        <span class="ActionScriptComment">//
</span>        <span class="ActionScriptComment">// The rest of the derivation is handled by computer algebra.
</span>        
        <span class="ActionScriptComment">//b2Settings.b2Assert(m_vertexCount &gt;= 2);
</span>        
        <span class="ActionScriptComment">// A line segment has zero mass.
</span>        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_vertexCount</span> <span class="ActionScriptOperator">==</span> 2<span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">massData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">center</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> 0.5 <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">massData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">center</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> 0.5 <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">massData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mass</span> <span class="ActionScriptOperator">=</span> 0.0;
            <span class="ActionScriptDefault_Text">massData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">I</span> <span class="ActionScriptOperator">=</span> 0.0;
            <span class="ActionScriptReserved">return</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptComment">//b2Vec2 center; center.Set(0.0f, 0.0f);
</span>        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">centerX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0.0;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">centerY</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0.0;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">area</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0.0;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">I</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0.0;
        
        <span class="ActionScriptComment">// pRef is the reference point for forming triangles.
</span>        <span class="ActionScriptComment">// It's location doesn't change the result (except for rounding error).
</span>        <span class="ActionScriptComment">//b2Vec2 pRef(0.0f, 0.0f);
</span>        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">p1X</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0.0;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">p1Y</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0.0;
        <span class="ActionScriptComment">/*#if 0
        // This code would put the reference point inside the polygon.
        for (int32 i = 0; i &lt; m_vertexCount; ++i)
        {
            pRef += m_vertices[i];
        }
        pRef *= 1.0f / count;
        #endif*/</span>
        
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">k_inv3</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 1.0 <span class="ActionScriptOperator">/</span> 3.0;
        
        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">m_vertexCount</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">// Triangle vertices.
</span>            <span class="ActionScriptComment">//b2Vec2 p1 = pRef;
</span>            <span class="ActionScriptComment">//
</span>            <span class="ActionScriptComment">//b2Vec2 p2 = m_vertices[i];
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">p2</span>:<span class="ActionScriptDefault_Text">b2Vec2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptComment">//b2Vec2 p3 = i + 1 &lt; m_vertexCount ? m_vertices[i+1] : m_vertices[0];
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">p3</span>:<span class="ActionScriptDefault_Text">b2Vec2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">+</span> 1 <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">m_vertexCount</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">]</span> : <span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>;
            
            <span class="ActionScriptComment">//b2Vec2 e1 = p2 - p1;
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">e1X</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">p1X</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">e1Y</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">p1Y</span>;
            <span class="ActionScriptComment">//b2Vec2 e2 = p3 - p1;
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">e2X</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p3</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">p1X</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">e2Y</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p3</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">p1Y</span>;
            
            <span class="ActionScriptComment">//float32 D = b2Cross(e1, e2);
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">D</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">e1X</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">e2Y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">e1Y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">e2X</span>;
            
            <span class="ActionScriptComment">//float32 triangleArea = 0.5f * D;
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">triangleArea</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0.5 <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">D</span>;
            <span class="ActionScriptDefault_Text">area</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">triangleArea</span>;
            
            <span class="ActionScriptComment">// Area weighted centroid
</span>            <span class="ActionScriptComment">//center += triangleArea * k_inv3 * (p1 + p2 + p3);
</span>            <span class="ActionScriptDefault_Text">centerX</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">triangleArea</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">k_inv3</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">p1X</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">p2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">p3</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">centerY</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">triangleArea</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">k_inv3</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">p1Y</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">p2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">p3</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">//float32 px = p1.x, py = p1.y;
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">px</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p1X</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">py</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p1Y</span>;
            <span class="ActionScriptComment">//float32 ex1 = e1.x, ey1 = e1.y;
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ex1</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">e1X</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ey1</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">e1Y</span>;
            <span class="ActionScriptComment">//float32 ex2 = e2.x, ey2 = e2.y;
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ex2</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">e2X</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ey2</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">e2Y</span>;
            
            <span class="ActionScriptComment">//float32 intx2 = k_inv3 * (0.25f * (ex1*ex1 + ex2*ex1 + ex2*ex2) + (px*ex1 + px*ex2)) + 0.5f*px*px;
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">intx2</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">k_inv3</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span>0.25 <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ex1</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">ex1</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">ex2</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">ex1</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">ex2</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">ex2</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">px</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">ex1</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">px</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">ex2</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> 0.5<span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">px</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">px</span>;
            <span class="ActionScriptComment">//float32 inty2 = k_inv3 * (0.25f * (ey1*ey1 + ey2*ey1 + ey2*ey2) + (py*ey1 + py*ey2)) + 0.5f*py*py;
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">inty2</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">k_inv3</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span>0.25 <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ey1</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">ey1</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">ey2</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">ey1</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">ey2</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">ey2</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">py</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">ey1</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">py</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">ey2</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> 0.5<span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">py</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">py</span>;
            
            <span class="ActionScriptDefault_Text">I</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">D</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">intx2</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">inty2</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptComment">// Total mass
</span>        <span class="ActionScriptDefault_Text">massData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mass</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">density</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">area</span>;
        
        <span class="ActionScriptComment">// Center of mass
</span>        <span class="ActionScriptComment">//b2Settings.b2Assert(area &gt; Number.MIN_VALUE);
</span>        <span class="ActionScriptComment">//center *= 1.0f / area;
</span>        <span class="ActionScriptDefault_Text">centerX</span> <span class="ActionScriptOperator">*=</span> 1.0 <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">area</span>;
        <span class="ActionScriptDefault_Text">centerY</span> <span class="ActionScriptOperator">*=</span> 1.0 <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">area</span>;
        <span class="ActionScriptComment">//massData-&gt;center = center;
</span>        <span class="ActionScriptDefault_Text">massData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">center</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Set</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">centerX</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">centerY</span><span class="ActionScriptBracket/Brace">)</span>;
        
        <span class="ActionScriptComment">// Inertia tensor relative to the local origin.
</span>        <span class="ActionScriptDefault_Text">massData</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">I</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">density</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">I</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptASDoc">/**
    * @inheritDoc
    */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">ComputeSubmergedArea</span><span class="ActionScriptBracket/Brace">(</span>
            <span class="ActionScriptDefault_Text">normal</span>:<span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptOperator">,</span>
            <span class="ActionScriptDefault_Text">offset</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span>
            <span class="ActionScriptDefault_Text">xf</span>:<span class="ActionScriptDefault_Text">b2Transform</span><span class="ActionScriptOperator">,</span>
            <span class="ActionScriptDefault_Text">c</span>:<span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Number</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptComment">// Transform plane into shape co-ordinates
</span>        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">normalL</span>:<span class="ActionScriptDefault_Text">b2Vec2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">b2Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MulTMV</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">xf</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">R</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">normal</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">offsetL</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">offset</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">b2Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Dot</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">normal</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">xf</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">position</span><span class="ActionScriptBracket/Brace">)</span>;
        
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">depths</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">diveCount</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">intoIndex</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> -1;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">outoIndex</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> -1;
        
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">lastSubmerged</span>:<span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span>;
        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">m_vertexCount</span>;<span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">depths</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">b2Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Dot</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">normalL</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">offsetL</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">isSubmerged</span>:<span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">depths</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MIN_VALUE</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">isSubmerged</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">lastSubmerged</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">intoIndex</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">-</span> 1;
                        <span class="ActionScriptDefault_Text">diveCount</span><span class="ActionScriptOperator">++</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lastSubmerged</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">outoIndex</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">-</span> 1;
                        <span class="ActionScriptDefault_Text">diveCount</span><span class="ActionScriptOperator">++</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptDefault_Text">lastSubmerged</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">isSubmerged</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">switch</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">diveCount</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">case</span> 0:
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lastSubmerged</span> <span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// Completely submerged
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">md</span>:<span class="ActionScriptDefault_Text">b2MassData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">b2MassData</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">ComputeMass</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">md</span><span class="ActionScriptOperator">,</span> 1<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetV</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">b2Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MulX</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">xf</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">md</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">center</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">md</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mass</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">//Completely dry
</span>                <span class="ActionScriptReserved">return</span> 0;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">break</span>;
            <span class="ActionScriptReserved">case</span> 1:
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">intoIndex</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">intoIndex</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_vertexCount</span> <span class="ActionScriptOperator">-</span> 1;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">outoIndex</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_vertexCount</span> <span class="ActionScriptOperator">-</span> 1;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">break</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">intoIndex2</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">intoIndex</span> <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">%</span> <span class="ActionScriptDefault_Text">m_vertexCount</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">outoIndex2</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">outoIndex</span> <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">%</span> <span class="ActionScriptDefault_Text">m_vertexCount</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">intoLamdda</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span>0 <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">depths</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">intoIndex</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">depths</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">intoIndex2</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">depths</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">intoIndex</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">outoLamdda</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span>0 <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">depths</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">outoIndex</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">depths</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">outoIndex2</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">depths</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">outoIndex</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
        
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">intoVec</span>:<span class="ActionScriptDefault_Text">b2Vec2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">intoIndex</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span>1 <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">intoLamdda</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">intoIndex2</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">intoLamdda</span><span class="ActionScriptOperator">,</span>
                                        <span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">intoIndex</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span>1 <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">intoLamdda</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">intoIndex2</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">intoLamdda</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">outoVec</span>:<span class="ActionScriptDefault_Text">b2Vec2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">outoIndex</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span>1 <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">outoLamdda</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">outoIndex2</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">outoLamdda</span><span class="ActionScriptOperator">,</span>
                                        <span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">outoIndex</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span>1 <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">outoLamdda</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">outoIndex2</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">outoLamdda</span><span class="ActionScriptBracket/Brace">)</span>;
                                        
        <span class="ActionScriptComment">// Initialize accumulator
</span>        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">area</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">center</span>:<span class="ActionScriptDefault_Text">b2Vec2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">p2</span>:<span class="ActionScriptDefault_Text">b2Vec2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">intoIndex2</span><span class="ActionScriptBracket/Brace">]</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">p3</span>:<span class="ActionScriptDefault_Text">b2Vec2</span>;
        
        <span class="ActionScriptComment">// An awkward loop from intoIndex2+1 to outIndex2
</span>        <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">intoIndex2</span>;
        <span class="ActionScriptReserved">while</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">outoIndex2</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">%</span> <span class="ActionScriptDefault_Text">m_vertexCount</span>;
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">outoIndex2</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">p3</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">outoVec</span>
            <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptDefault_Text">p3</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">triangleArea</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0.5 <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">p2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">intoVec</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">p3</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">intoVec</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">p2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">intoVec</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">p3</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">intoVec</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">area</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">triangleArea</span>;
            <span class="ActionScriptComment">// Area weighted centroid
</span>            <span class="ActionScriptDefault_Text">center</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">triangleArea</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">intoVec</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">p2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">p3</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">/</span> 3;
            <span class="ActionScriptDefault_Text">center</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">triangleArea</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">intoVec</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">p2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">p3</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">/</span> 3;
            
            <span class="ActionScriptDefault_Text">p2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p3</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptComment">//Normalize and transform centroid
</span>        <span class="ActionScriptDefault_Text">center</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Multiply</span><span class="ActionScriptBracket/Brace">(</span>1 <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">area</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetV</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">b2Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MulX</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">xf</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">center</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
        
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">area</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    
    <span class="ActionScriptASDoc">/**
    * Get the vertex count.
    */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">GetVertexCount</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">m_vertexCount</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptASDoc">/**
    * Get the vertices in local coordinates.
    */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">GetVertices</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">m_vertices</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    
    <span class="ActionScriptASDoc">/**
    * Get the edge normal vectors. There is one for each vertex.
    */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">GetNormals</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">&gt;</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">m_normals</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    
    <span class="ActionScriptASDoc">/**
     * Get the supporting vertex index in the given direction.
     */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">GetSupport</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">d</span>:<span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">int</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bestIndex</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bestValue</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span> 1; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">m_vertexCount</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">value</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span> <span class="ActionScriptOperator">&gt;</span> <span class="ActionScriptDefault_Text">bestValue</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">bestIndex</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i</span>;
                <span class="ActionScriptDefault_Text">bestValue</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">value</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">bestIndex</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">GetSupportVertex</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">d</span>:<span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">b2Vec2</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bestIndex</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bestValue</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span> 1; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">m_vertexCount</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">value</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span> <span class="ActionScriptOperator">&gt;</span> <span class="ActionScriptDefault_Text">bestValue</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">bestIndex</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i</span>;
                <span class="ActionScriptDefault_Text">bestValue</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">value</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">bestIndex</span><span class="ActionScriptBracket/Brace">]</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptComment">// TODO: Expose this
</span>    <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">Validate</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Boolean</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptComment">/*
        // Ensure the polygon is convex.
        for (int32 i = 0; i &lt; m_vertexCount; ++i)
        {
            for (int32 j = 0; j &lt; m_vertexCount; ++j)
            {
                // Don't check vertices on the current edge.
                if (j == i || j == (i + 1) % m_vertexCount)
                {
                    continue;
                }
                
                // Your polygon is non-convex (it has an indentation).
                // Or your polygon is too skinny.
                float32 s = b2Dot(m_normals[i], m_vertices[j] - m_vertices[i]);
                b2Assert(s &lt; -b2_linearSlop);
            }
        }
        
        // Ensure the polygon is counter-clockwise.
        for (i = 1; i &lt; m_vertexCount; ++i)
        {
            var cross:Number = b2Math.b2CrossVV(m_normals[int(i-1)], m_normals[i]);
            
            // Keep asinf happy.
            cross = b2Math.b2Clamp(cross, -1.0, 1.0);
            
            // You have consecutive edges that are almost parallel on your polygon.
            var angle:Number = Math.asin(cross);
            //b2Assert(angle &gt; b2_angularSlop);
            trace(angle &gt; b2Settings.b2_angularSlop);
        }
        */</span>
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptComment">//--------------- Internals Below -------------------
</span>    
    <span class="ActionScriptASDoc">/**
     * @private
     */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">b2PolygonShape</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
        
        <span class="ActionScriptComment">//b2Settings.b2Assert(def.type == e_polygonShape);
</span>        <span class="ActionScriptDefault_Text">m_type</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">e_polygonShape</span>;
        
        <span class="ActionScriptDefault_Text">m_centroid</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">m_vertices</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">m_normals</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">Reserve</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">count</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">count</span>; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">m_vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">m_normals</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptComment">// Local position of the polygon centroid.
</span>    <span class="ActionScriptDefault_Text">b2internal</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m_centroid</span>:<span class="ActionScriptDefault_Text">b2Vec2</span>;

    <span class="ActionScriptDefault_Text">b2internal</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m_vertices</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">&gt;</span>;
    <span class="ActionScriptDefault_Text">b2internal</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m_normals</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">&gt;</span>;
    
    <span class="ActionScriptDefault_Text">b2internal</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m_vertexCount</span>:<span class="ActionScriptDefault_Text">int</span>;
    
    
    
    <span class="ActionScriptASDoc">/**
     * Computes the centroid of the given polygon
     * @param    vs        vector of b2Vec specifying a polygon
     * @param    count    length of vs
     * @return the polygon centroid
     */</span>
    <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">ComputeCentroid</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vs</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">count</span>:<span class="ActionScriptDefault_Text">uint</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptDefault_Text">b2Vec2</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptComment">//b2Settings.b2Assert(count &gt;= 3);
</span>        
        <span class="ActionScriptComment">//b2Vec2 c; c.Set(0.0f, 0.0f);
</span>        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">c</span>:<span class="ActionScriptDefault_Text">b2Vec2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">area</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0.0;
        
        <span class="ActionScriptComment">// pRef is the reference point for forming triangles.
</span>        <span class="ActionScriptComment">// It's location doesn't change the result (except for rounding error).
</span>        <span class="ActionScriptComment">//b2Vec2 pRef(0.0f, 0.0f);
</span>        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">p1X</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0.0;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">p1Y</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0.0;
    <span class="ActionScriptComment">/*#if 0
        // This code would put the reference point inside the polygon.
        for (int32 i = 0; i &lt; count; ++i)
        {
            pRef += vs[i];
        }
        pRef *= 1.0f / count;
    #endif*/</span>
        
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">inv3</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 1.0 <span class="ActionScriptOperator">/</span> 3.0;
        
        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">count</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">// Triangle vertices.
</span>            <span class="ActionScriptComment">//b2Vec2 p1 = pRef;
</span>                <span class="ActionScriptComment">// 0.0, 0.0
</span>            <span class="ActionScriptComment">//b2Vec2 p2 = vs[i];
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">p2</span>:<span class="ActionScriptDefault_Text">b2Vec2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vs</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptComment">//b2Vec2 p3 = i + 1 &lt; count ? vs[i+1] : vs[0];
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">p3</span>:<span class="ActionScriptDefault_Text">b2Vec2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">+</span> 1 <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">count</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">vs</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">]</span> : <span class="ActionScriptDefault_Text">vs</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>;
            
            <span class="ActionScriptComment">//b2Vec2 e1 = p2 - p1;
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">e1X</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">p1X</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">e1Y</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">p1Y</span>;
            <span class="ActionScriptComment">//b2Vec2 e2 = p3 - p1;
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">e2X</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p3</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">p1X</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">e2Y</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p3</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">p1Y</span>;
            
            <span class="ActionScriptComment">//float32 D = b2Cross(e1, e2);
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">D</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e1X</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">e2Y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">e1Y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">e2X</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">//float32 triangleArea = 0.5f * D;
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">triangleArea</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0.5 <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">D</span>;
            <span class="ActionScriptDefault_Text">area</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">triangleArea</span>;
            
            <span class="ActionScriptComment">// Area weighted centroid
</span>            <span class="ActionScriptComment">//c += triangleArea * inv3 * (p1 + p2 + p3);
</span>            <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">triangleArea</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">inv3</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">p1X</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">p2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">p3</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">triangleArea</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">inv3</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">p1Y</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">p2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">p3</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptComment">// Centroid
</span>        <span class="ActionScriptComment">//beSettings.b2Assert(area &gt; Number.MIN_VALUE);
</span>        <span class="ActionScriptComment">//c *= 1.0 / area;
</span>        <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*=</span> 1.0 <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">area</span>;
        <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*=</span> 1.0 <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">area</span>;
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">c</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptASDoc">/**
     * Computes a polygon's OBB
     * @see http://www.geometrictools.com/Documentation/MinimumAreaRectangle.pdf
     */</span>
    <span class="ActionScriptReserved">static</span> <span class="ActionScriptDefault_Text">b2internal</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">ComputeOBB</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">obb</span>:<span class="ActionScriptDefault_Text">b2OBB</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">vs</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">count</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">p</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">&gt;</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">count</span> <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">count</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vs</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">count</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>;
        
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">minArea</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MAX_VALUE</span>;
        
        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 1; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;=</span> <span class="ActionScriptDefault_Text">count</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">root</span>:<span class="ActionScriptDefault_Text">b2Vec2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptComment">//b2Vec2 ux = p[i] - root;
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">uxX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">root</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">uxY</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">root</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
            <span class="ActionScriptComment">//var length:Number = ux.Normalize();
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">length</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sqrt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uxX</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">uxX</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">uxY</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">uxY</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">uxX</span> <span class="ActionScriptOperator">/=</span> <span class="ActionScriptDefault_Text">length</span>;
            <span class="ActionScriptDefault_Text">uxY</span> <span class="ActionScriptOperator">/=</span> <span class="ActionScriptDefault_Text">length</span>;
            <span class="ActionScriptComment">//b2Settings.b2Assert(length &gt; Number.MIN_VALUE);
</span>            <span class="ActionScriptComment">//b2Vec2 uy(-ux.y, ux.x);
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">uyX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">uxY</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">uyY</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">uxX</span>;
            <span class="ActionScriptComment">//b2Vec2 lower(FLT_MAX, FLT_MAX);
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">lowerX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MAX_VALUE</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">lowerY</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MAX_VALUE</span>;
            <span class="ActionScriptComment">//b2Vec2 upper(-FLT_MAX, -FLT_MAX);
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">upperX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MAX_VALUE</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">upperY</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MAX_VALUE</span>;
            
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">j</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">count</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">//b2Vec2 d = p[j] - root;
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">root</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dY</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">root</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
                <span class="ActionScriptComment">//b2Vec2 r;
</span>                <span class="ActionScriptComment">//var rX:Number = b2Dot(ux, d);
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uxX</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">dX</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">uxY</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">dY</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptComment">//var rY:Number = b2Dot(uy, d);
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rY</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uyX</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">dX</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">uyY</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">dY</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptComment">//lower = b2Min(lower, r);
</span>                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">rX</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">lowerX</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">lowerX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">rX</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">rY</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">lowerY</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">lowerY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">rY</span>;
                <span class="ActionScriptComment">//upper = b2Max(upper, r);
</span>                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">rX</span> <span class="ActionScriptOperator">&gt;</span> <span class="ActionScriptDefault_Text">upperX</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">upperX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">rX</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">rY</span> <span class="ActionScriptOperator">&gt;</span> <span class="ActionScriptDefault_Text">upperY</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">upperY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">rY</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">area</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">upperX</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">lowerX</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">upperY</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">lowerY</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">area</span> <span class="ActionScriptOperator">&lt;</span> 0.95 <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">minArea</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">minArea</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">area</span>;
                <span class="ActionScriptComment">//obb-&gt;R.col1 = ux;
</span>                <span class="ActionScriptDefault_Text">obb</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">R</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">uxX</span>;
                <span class="ActionScriptDefault_Text">obb</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">R</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">uxY</span>;
                <span class="ActionScriptComment">//obb-&gt;R.col2 = uy;
</span>                <span class="ActionScriptDefault_Text">obb</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">R</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">uyX</span>;
                <span class="ActionScriptDefault_Text">obb</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">R</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">uyY</span>;
                <span class="ActionScriptComment">//b2Vec2 center = 0.5f * (lower + upper);
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">centerX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0.5 <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lowerX</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">upperX</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">centerY</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0.5 <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lowerY</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">upperY</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptComment">//obb-&gt;center = root + b2Mul(obb-&gt;R, center);
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tMat</span>:<span class="ActionScriptDefault_Text">b2Mat22</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">obb</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">R</span>;
                <span class="ActionScriptDefault_Text">obb</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">center</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">root</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">centerX</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">centerY</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">obb</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">center</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">root</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">centerX</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">centerY</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptComment">//obb-&gt;extents = 0.5f * (upper - lower);
</span>                <span class="ActionScriptDefault_Text">obb</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">extents</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> 0.5 <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">upperX</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">lowerX</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">obb</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">extents</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> 0.5 <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">upperY</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">lowerY</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptComment">//b2Settings.b2Assert(minArea &lt; Number.MAX_VALUE);
</span>    <span class="ActionScriptBracket/Brace">}</span>
    
    
<span class="ActionScriptBracket/Brace">}</span>;

<span class="ActionScriptBracket/Brace">}</span>
</pre></body>
</html>
