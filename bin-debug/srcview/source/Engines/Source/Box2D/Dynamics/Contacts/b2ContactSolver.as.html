<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>b2ContactSolver.as</title>
<link rel="stylesheet" type="text/css" href="../../../../../../SourceStyles.css"/>
</head>

<body><pre><span class="ActionScriptComment">/*
* Copyright (c) 2006-2007 Erin Catto http://www.gphysics.com
*
* This software is provided 'as-is', without any express or implied
* warranty.  In no event will the authors be held liable for any damages
* arising from the use of this software.
* Permission is granted to anyone to use this software for any purpose,
* including commercial applications, and to alter it and redistribute it
* freely, subject to the following restrictions:
* 1. The origin of this software must not be misrepresented; you must not
* claim that you wrote the original software. If you use this software
* in a product, an acknowledgment in the product documentation would be
* appreciated but is not required.
* 2. Altered source versions must be plainly marked as such, and must not be
* misrepresented as being the original software.
* 3. This notice may not be removed or altered from any source distribution.
*/</span>

<span class="ActionScriptpackage">package</span> <span class="ActionScriptDefault_Text">Box2D</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Dynamics</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Contacts</span><span class="ActionScriptBracket/Brace">{</span>

    
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">Box2D</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Collision</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Shapes</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">b2Shape</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">Box2D</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Dynamics</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">*</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">Box2D</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Collision</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">*</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">Box2D</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Common</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">*</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">Box2D</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Common</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">*</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">Box2D</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Dynamics</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Contacts</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">*</span>;

<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">Box2D</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Common</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">b2internal</span>;
<span class="ActionScriptReserved">use</span> <span class="ActionScriptReserved">namespace</span> <span class="ActionScriptDefault_Text">b2internal</span>;


<span class="ActionScriptASDoc">/**
* @private
*/</span>
<span class="ActionScriptReserved">public</span> <span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">b2ContactSolver</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">b2ContactSolver</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>
    <span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptBracket/Brace">}</span>
    
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">s_worldManifold</span>:<span class="ActionScriptDefault_Text">b2WorldManifold</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">b2WorldManifold</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">Initialize</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">step</span>:<span class="ActionScriptDefault_Text">b2TimeStep</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">contacts</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">b2Contact</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">contactCount</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">allocator</span>:<span class="ActionScriptOperator">*</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">contact</span>:<span class="ActionScriptDefault_Text">b2Contact</span>;
        
        <span class="ActionScriptDefault_Text">m_step</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Set</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">step</span><span class="ActionScriptBracket/Brace">)</span>
        
        <span class="ActionScriptDefault_Text">m_allocator</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">allocator</span>;
        
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tVec</span>:<span class="ActionScriptDefault_Text">b2Vec2</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tMat</span>:<span class="ActionScriptDefault_Text">b2Mat22</span>;
        
        <span class="ActionScriptDefault_Text">m_constraintCount</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">contactCount</span>;

        <span class="ActionScriptComment">// fill vector to hold enough constraints
</span>        <span class="ActionScriptReserved">while</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_constraints</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">m_constraintCount</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">m_constraints</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">m_constraints</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">b2ContactConstraint</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">contactCount</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">contact</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">contacts</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">fixtureA</span>:<span class="ActionScriptDefault_Text">b2Fixture</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">contact</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_fixtureA</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">fixtureB</span>:<span class="ActionScriptDefault_Text">b2Fixture</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">contact</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_fixtureB</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">shapeA</span>:<span class="ActionScriptDefault_Text">b2Shape</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">fixtureA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_shape</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">shapeB</span>:<span class="ActionScriptDefault_Text">b2Shape</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">fixtureB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_shape</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">radiusA</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">shapeA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_radius</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">radiusB</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">shapeB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_radius</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bodyA</span>:<span class="ActionScriptDefault_Text">b2Body</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">fixtureA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_body</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bodyB</span>:<span class="ActionScriptDefault_Text">b2Body</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">fixtureB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_body</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">manifold</span>:<span class="ActionScriptDefault_Text">b2Manifold</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">contact</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">GetManifold</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">friction</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">b2Settings</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">b2MixFriction</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">fixtureA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">GetFriction</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">fixtureB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">GetFriction</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">restitution</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">b2Settings</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">b2MixRestitution</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">fixtureA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">GetRestitution</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">fixtureB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">GetRestitution</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">//var vA:b2Vec2 = bodyA.m_linearVelocity.Copy();
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vAX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bodyA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_linearVelocity</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vAY</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bodyA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_linearVelocity</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
            <span class="ActionScriptComment">//var vB:b2Vec2 = bodyB.m_linearVelocity.Copy();
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vBX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bodyB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_linearVelocity</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vBY</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bodyB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_linearVelocity</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">wA</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bodyA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_angularVelocity</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">wB</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bodyB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_angularVelocity</span>;
            
            <span class="ActionScriptDefault_Text">b2Settings</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">b2Assert</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">manifold</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_pointCount</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">s_worldManifold</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Initialize</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">manifold</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">bodyA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_xf</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">radiusA</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">bodyB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_xf</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">radiusB</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">normalX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">s_worldManifold</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_normal</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">normalY</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">s_worldManifold</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_normal</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cc</span>:<span class="ActionScriptDefault_Text">b2ContactConstraint</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_constraints</span><span class="ActionScriptBracket/Brace">[</span> <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptDefault_Text">cc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bodyA</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bodyA</span>; <span class="ActionScriptComment">//p
</span>            <span class="ActionScriptDefault_Text">cc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bodyB</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bodyB</span>; <span class="ActionScriptComment">//p
</span>            <span class="ActionScriptDefault_Text">cc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">manifold</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">manifold</span>; <span class="ActionScriptComment">//p
</span>            <span class="ActionScriptComment">//c.normal = normal;
</span>            <span class="ActionScriptDefault_Text">cc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">normal</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">normalX</span>;
            <span class="ActionScriptDefault_Text">cc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">normal</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">normalY</span>;
            <span class="ActionScriptDefault_Text">cc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">pointCount</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">manifold</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_pointCount</span>;
            <span class="ActionScriptDefault_Text">cc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">friction</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">friction</span>;
            <span class="ActionScriptDefault_Text">cc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">restitution</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">restitution</span>;
            
            <span class="ActionScriptDefault_Text">cc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">localPlaneNormal</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">manifold</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_localPlaneNormal</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
            <span class="ActionScriptDefault_Text">cc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">localPlaneNormal</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">manifold</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_localPlaneNormal</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
            <span class="ActionScriptDefault_Text">cc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">localPoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">manifold</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_localPoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
            <span class="ActionScriptDefault_Text">cc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">localPoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">manifold</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_localPoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
            <span class="ActionScriptDefault_Text">cc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">radius</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">radiusA</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">radiusB</span>;
            <span class="ActionScriptDefault_Text">cc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">type</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">manifold</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_type</span>;
            
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">k</span>:<span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">k</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">cc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">pointCount</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">k</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cp</span>:<span class="ActionScriptDefault_Text">b2ManifoldPoint</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">manifold</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_points</span><span class="ActionScriptBracket/Brace">[</span> <span class="ActionScriptDefault_Text">k</span> <span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ccp</span>:<span class="ActionScriptDefault_Text">b2ContactConstraintPoint</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">points</span><span class="ActionScriptBracket/Brace">[</span> <span class="ActionScriptDefault_Text">k</span> <span class="ActionScriptBracket/Brace">]</span>;
                
                <span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">normalImpulse</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_normalImpulse</span>;
                <span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">tangentImpulse</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_tangentImpulse</span>;
                
                <span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">localPoint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetV</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_localPoint</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rAX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">s_worldManifold</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_points</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">k</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">bodyA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_sweep</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rAY</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">s_worldManifold</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_points</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">k</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">bodyA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_sweep</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rBX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">s_worldManifold</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_points</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">k</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">bodyB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_sweep</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rBY</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">s_worldManifold</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_points</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">k</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">bodyB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_sweep</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
                
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rnA</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">rAX</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">normalY</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">rAY</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">normalX</span>;<span class="ActionScriptComment">//b2Math.b2Cross(r1, normal);
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rnB</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">rBX</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">normalY</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">rBY</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">normalX</span>;<span class="ActionScriptComment">//b2Math.b2Cross(r2, normal);
</span>                
                <span class="ActionScriptDefault_Text">rnA</span> <span class="ActionScriptOperator">*=</span> <span class="ActionScriptDefault_Text">rnA</span>;
                <span class="ActionScriptDefault_Text">rnB</span> <span class="ActionScriptOperator">*=</span> <span class="ActionScriptDefault_Text">rnB</span>;
                
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">kNormal</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bodyA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invMass</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">bodyB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invMass</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">bodyA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invI</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">rnA</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">bodyB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invI</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">rnB</span>;
                <span class="ActionScriptComment">//b2Settings.b2Assert(kNormal &gt; Number.MIN_VALUE);
</span>                <span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">normalMass</span> <span class="ActionScriptOperator">=</span> 1.0 <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">kNormal</span>;
                
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">kEqualized</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bodyA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_mass</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">bodyA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invMass</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">bodyB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_mass</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">bodyB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invMass</span>;
                <span class="ActionScriptDefault_Text">kEqualized</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">bodyA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_mass</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">bodyA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invI</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">rnA</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">bodyB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_mass</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">bodyB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invI</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">rnB</span>;
                <span class="ActionScriptComment">//b2Assert(kEqualized &gt; Number.MIN_VALUE);
</span>                <span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">equalizedMass</span> <span class="ActionScriptOperator">=</span> 1.0 <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">kEqualized</span>;
                
                <span class="ActionScriptComment">//var tangent:b2Vec2 = b2Math.b2CrossVF(normal, 1.0);
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tangentX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">normalY</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tangentY</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">normalX</span>;
                
                <span class="ActionScriptComment">//var rtA:Number = b2Math.b2Cross(rA, tangent);
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rtA</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">rAX</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">tangentY</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">rAY</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">tangentX</span>;
                <span class="ActionScriptComment">//var rtB:Number = b2Math.b2Cross(rB, tangent);
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rtB</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">rBX</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">tangentY</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">rBY</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">tangentX</span>;
                
                <span class="ActionScriptDefault_Text">rtA</span> <span class="ActionScriptOperator">*=</span> <span class="ActionScriptDefault_Text">rtA</span>;
                <span class="ActionScriptDefault_Text">rtB</span> <span class="ActionScriptOperator">*=</span> <span class="ActionScriptDefault_Text">rtB</span>;
                
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">kTangent</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bodyA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invMass</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">bodyB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invMass</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">bodyA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invI</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">rtA</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">bodyB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invI</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">rtB</span>;
                <span class="ActionScriptComment">//b2Settings.b2Assert(kTangent &gt; Number.MIN_VALUE);
</span>                <span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">tangentMass</span> <span class="ActionScriptOperator">=</span> 1.0 <span class="ActionScriptOperator">/</span>  <span class="ActionScriptDefault_Text">kTangent</span>;
                
                <span class="ActionScriptComment">// Setup a velocity bias for restitution.
</span>                <span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">velocityBias</span> <span class="ActionScriptOperator">=</span> 0.0;
                <span class="ActionScriptComment">//b2Dot(c.normal, vB + b2Cross(wB, rB) - vA - b2Cross(wA, rA));
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vBX</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">wB</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">rBY</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">vAX</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">wA</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">rAY</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tY</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vBY</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">wB</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">rBX</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">vAY</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">wA</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">rAX</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptComment">//var vRel:Number = b2Dot(cc.normal, t);
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vRel</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">normal</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">tX</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">normal</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">tY</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vRel</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">b2Settings</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">b2_velocityThreshold</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">velocityBias</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">cc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">restitution</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">vRel</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">// If we have two points, then prepare the block solver.
</span>            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">pointCount</span> <span class="ActionScriptOperator">==</span> 2<span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ccp1</span>:<span class="ActionScriptDefault_Text">b2ContactConstraintPoint</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">points</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ccp2</span>:<span class="ActionScriptDefault_Text">b2ContactConstraintPoint</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">points</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span>;
                
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">invMassA</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bodyA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invMass</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">invIA</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bodyA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invI</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">invMassB</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bodyB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invMass</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">invIB</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bodyB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invI</span>;
                
                <span class="ActionScriptComment">//var rn1A:Number = b2Cross(ccp1.rA, normal);
</span>                <span class="ActionScriptComment">//var rn1B:Number = b2Cross(ccp1.rB, normal);
</span>                <span class="ActionScriptComment">//var rn2A:Number = b2Cross(ccp2.rA, normal);
</span>                <span class="ActionScriptComment">//var rn2B:Number = b2Cross(ccp2.rB, normal);
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rn1A</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ccp1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">normalY</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">ccp1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">normalX</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rn1B</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ccp1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">normalY</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">ccp1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">normalX</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rn2A</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ccp2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">normalY</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">ccp2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">normalX</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rn2B</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ccp2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">normalY</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">ccp2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">normalX</span>;
                
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">k11</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">invMassA</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">invMassB</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">invIA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">rn1A</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">rn1A</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">invIB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">rn1B</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">rn1B</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">k22</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">invMassA</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">invMassB</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">invIA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">rn2A</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">rn2A</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">invIB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">rn2B</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">rn2B</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">k12</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">invMassA</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">invMassB</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">invIA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">rn1A</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">rn2A</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">invIB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">rn1B</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">rn2B</span>;
                
                <span class="ActionScriptComment">// Ensure a reasonable condition number.
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">k_maxConditionNumber</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 100.0;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">k11</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">k11</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">k_maxConditionNumber</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">k11</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">k22</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">k12</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">k12</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">// K is safe to invert.
</span>                    <span class="ActionScriptDefault_Text">cc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">K</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Set</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">k11</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">k12</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">cc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">K</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Set</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">k12</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">k22</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">cc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">K</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">GetInverse</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">normalMass</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">// The constraints are redundant, just use one.
</span>                    <span class="ActionScriptComment">// TODO_ERIN use deepest?
</span>                    <span class="ActionScriptDefault_Text">cc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">pointCount</span> <span class="ActionScriptOperator">=</span> 1;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptComment">//b2Settings.b2Assert(count == m_constraintCount);
</span>    <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptComment">//~b2ContactSolver();
</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">InitVelocityConstraints</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">step</span>: <span class="ActionScriptDefault_Text">b2TimeStep</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span><span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tVec</span>:<span class="ActionScriptDefault_Text">b2Vec2</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tVec2</span>:<span class="ActionScriptDefault_Text">b2Vec2</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tMat</span>:<span class="ActionScriptDefault_Text">b2Mat22</span>;
        
        <span class="ActionScriptComment">// Warm start.
</span>        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">m_constraintCount</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">c</span>:<span class="ActionScriptDefault_Text">b2ContactConstraint</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_constraints</span><span class="ActionScriptBracket/Brace">[</span> <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptBracket/Brace">]</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bodyA</span>:<span class="ActionScriptDefault_Text">b2Body</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bodyA</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bodyB</span>:<span class="ActionScriptDefault_Text">b2Body</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bodyB</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">invMassA</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bodyA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invMass</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">invIA</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bodyA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invI</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">invMassB</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bodyB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invMass</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">invIB</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bodyB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invI</span>;
            <span class="ActionScriptComment">//var normal:b2Vec2 = new b2Vec2(c.normal.x, c.normal.y);
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">normalX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">normal</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">normalY</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">normal</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
            <span class="ActionScriptComment">//var tangent:b2Vec2 = b2Math.b2CrossVF(normal, 1.0);
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tangentX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">normalY</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tangentY</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">normalX</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tX</span>:<span class="ActionScriptDefault_Text">Number</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">j</span>:<span class="ActionScriptDefault_Text">int</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tCount</span>:<span class="ActionScriptDefault_Text">int</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">step</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">warmStarting</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">tCount</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">pointCount</span>;
                <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">tCount</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ccp</span>:<span class="ActionScriptDefault_Text">b2ContactConstraintPoint</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">points</span><span class="ActionScriptBracket/Brace">[</span> <span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptBracket/Brace">]</span>;
                    <span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">normalImpulse</span> <span class="ActionScriptOperator">*=</span> <span class="ActionScriptDefault_Text">step</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dtRatio</span>;
                    <span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">tangentImpulse</span> <span class="ActionScriptOperator">*=</span> <span class="ActionScriptDefault_Text">step</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dtRatio</span>;
                    <span class="ActionScriptComment">//b2Vec2 P = ccp-&gt;normalImpulse * normal + ccp-&gt;tangentImpulse * tangent;
</span>                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">PX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">normalImpulse</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">normalX</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">tangentImpulse</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">tangentX</span>;
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">PY</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">normalImpulse</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">normalY</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">tangentImpulse</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">tangentY</span>;
                    
                    <span class="ActionScriptComment">//bodyA.m_angularVelocity -= invIA * b2Math.b2CrossVV(rA, P);
</span>                    <span class="ActionScriptDefault_Text">bodyA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_angularVelocity</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">invIA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PY</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PX</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptComment">//bodyA.m_linearVelocity.Subtract( b2Math.MulFV(invMassA, P) );
</span>                    <span class="ActionScriptDefault_Text">bodyA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_linearVelocity</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">invMassA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PX</span>;
                    <span class="ActionScriptDefault_Text">bodyA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_linearVelocity</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">invMassA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PY</span>;
                    <span class="ActionScriptComment">//bodyB.m_angularVelocity += invIB * b2Math.b2CrossVV(rB, P);
</span>                    <span class="ActionScriptDefault_Text">bodyB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_angularVelocity</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">invIB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PY</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PX</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptComment">//bodyB.m_linearVelocity.Add( b2Math.MulFV(invMassB, P) );
</span>                    <span class="ActionScriptDefault_Text">bodyB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_linearVelocity</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">invMassB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PX</span>;
                    <span class="ActionScriptDefault_Text">bodyB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_linearVelocity</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">invMassB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PY</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">tCount</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">pointCount</span>;
                <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">tCount</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ccp2</span>:<span class="ActionScriptDefault_Text">b2ContactConstraintPoint</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">points</span><span class="ActionScriptBracket/Brace">[</span> <span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptBracket/Brace">]</span>;
                    <span class="ActionScriptDefault_Text">ccp2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">normalImpulse</span> <span class="ActionScriptOperator">=</span> 0.0;
                    <span class="ActionScriptDefault_Text">ccp2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">tangentImpulse</span> <span class="ActionScriptOperator">=</span> 0.0;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">SolveVelocityConstraints</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span><span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">j</span>:<span class="ActionScriptDefault_Text">int</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ccp</span>:<span class="ActionScriptDefault_Text">b2ContactConstraintPoint</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rAX</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rAY</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rBX</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rBY</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dvX</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dvY</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vn</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vt</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">lambda</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">maxFriction</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">newImpulse</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">PX</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">PY</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dX</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dY</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">P1X</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">P1Y</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">P2X</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">P2Y</span>:<span class="ActionScriptDefault_Text">Number</span>;
        
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tMat</span>:<span class="ActionScriptDefault_Text">b2Mat22</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tVec</span>:<span class="ActionScriptDefault_Text">b2Vec2</span>;
        
        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">m_constraintCount</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">c</span>:<span class="ActionScriptDefault_Text">b2ContactConstraint</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_constraints</span><span class="ActionScriptBracket/Brace">[</span> <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bodyA</span>:<span class="ActionScriptDefault_Text">b2Body</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bodyA</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bodyB</span>:<span class="ActionScriptDefault_Text">b2Body</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bodyB</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">wA</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bodyA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_angularVelocity</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">wB</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bodyB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_angularVelocity</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vA</span>:<span class="ActionScriptDefault_Text">b2Vec2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bodyA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_linearVelocity</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vB</span>:<span class="ActionScriptDefault_Text">b2Vec2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bodyB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_linearVelocity</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">invMassA</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bodyA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invMass</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">invIA</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bodyA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invI</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">invMassB</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bodyB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invMass</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">invIB</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bodyB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invI</span>;
            <span class="ActionScriptComment">//var normal:b2Vec2 = new b2Vec2(c.normal.x, c.normal.y);
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">normalX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">normal</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">normalY</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">normal</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
            <span class="ActionScriptComment">//var tangent:b2Vec2 = b2Math.b2CrossVF(normal, 1.0);
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tangentX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">normalY</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tangentY</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">normalX</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">friction</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">friction</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tX</span>:<span class="ActionScriptDefault_Text">Number</span>;
            
            <span class="ActionScriptComment">//b2Settings.b2Assert(c.pointCount == 1 || c.pointCount == 2);
</span>            <span class="ActionScriptComment">// Solve the tangent constraints
</span>            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">pointCount</span>; <span class="ActionScriptDefault_Text">j</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">ccp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">points</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptBracket/Brace">]</span>;
                
                <span class="ActionScriptComment">// Relative velocity at contact
</span>                <span class="ActionScriptComment">//b2Vec2 dv = vB + b2Cross(wB, ccp-&gt;rB) - vA - b2Cross(wA, ccp-&gt;rA);
</span>                <span class="ActionScriptDefault_Text">dvX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">wB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">vA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">wA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
                <span class="ActionScriptDefault_Text">dvY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">wB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">vA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">wA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
                
                <span class="ActionScriptComment">// Compute tangent force
</span>                <span class="ActionScriptDefault_Text">vt</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dvX</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">tangentX</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">dvY</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">tangentY</span>;
                <span class="ActionScriptDefault_Text">lambda</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">tangentMass</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">vt</span>;
                
                <span class="ActionScriptComment">// b2Clamp the accumulated force
</span>                <span class="ActionScriptDefault_Text">maxFriction</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">friction</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">normalImpulse</span>;
                <span class="ActionScriptDefault_Text">newImpulse</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">b2Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Clamp</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">tangentImpulse</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">lambda</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">maxFriction</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">maxFriction</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">lambda</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">newImpulse</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">tangentImpulse</span>;
                
                <span class="ActionScriptComment">// Apply contact impulse
</span>                <span class="ActionScriptDefault_Text">PX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">lambda</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">tangentX</span>;
                <span class="ActionScriptDefault_Text">PY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">lambda</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">tangentY</span>;
                
                <span class="ActionScriptDefault_Text">vA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">invMassA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PX</span>;
                <span class="ActionScriptDefault_Text">vA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">invMassA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PY</span>;
                <span class="ActionScriptDefault_Text">wA</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">invIA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PY</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PX</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptDefault_Text">vB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">invMassB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PX</span>;
                <span class="ActionScriptDefault_Text">vB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">invMassB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PY</span>;
                <span class="ActionScriptDefault_Text">wB</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">invIB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PY</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PX</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">tangentImpulse</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">newImpulse</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">// Solve the normal constraints
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tCount</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">pointCount</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">pointCount</span> <span class="ActionScriptOperator">==</span> 1<span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">ccp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">points</span><span class="ActionScriptBracket/Brace">[</span> 0 <span class="ActionScriptBracket/Brace">]</span>;
                
                <span class="ActionScriptComment">// Relative velocity at contact
</span>                <span class="ActionScriptComment">//b2Vec2 dv = vB + b2Cross(wB, ccp-&gt;rB) - vA - b2Cross(wA, ccp-&gt;rA);
</span>                <span class="ActionScriptDefault_Text">dvX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">wB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">vA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">wA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">dvY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">wB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">vA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">wA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptComment">// Compute normal impulse
</span>                <span class="ActionScriptComment">//var vn:Number = b2Math.b2Dot(dv, normal);
</span>                <span class="ActionScriptDefault_Text">vn</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dvX</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">normalX</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">dvY</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">normalY</span>;
                <span class="ActionScriptDefault_Text">lambda</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">normalMass</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">velocityBias</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptComment">// b2Clamp the accumulated impulse
</span>                <span class="ActionScriptComment">//newImpulse = b2Math.b2Max(ccp.normalImpulse + lambda, 0.0);
</span>                <span class="ActionScriptDefault_Text">newImpulse</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">normalImpulse</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">lambda</span>;
                <span class="ActionScriptDefault_Text">newImpulse</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">newImpulse</span> <span class="ActionScriptOperator">&gt;</span> 0 <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">newImpulse</span> : 0.0;
                <span class="ActionScriptDefault_Text">lambda</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">newImpulse</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">normalImpulse</span>;
                
                <span class="ActionScriptComment">// Apply contact impulse
</span>                <span class="ActionScriptComment">//b2Vec2 P = lambda * normal;
</span>                <span class="ActionScriptDefault_Text">PX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">lambda</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">normalX</span>;
                <span class="ActionScriptDefault_Text">PY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">lambda</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">normalY</span>;
                
                <span class="ActionScriptComment">//vA.Subtract( b2Math.MulFV( invMassA, P ) );
</span>                <span class="ActionScriptDefault_Text">vA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">invMassA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PX</span>;
                <span class="ActionScriptDefault_Text">vA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">invMassA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PY</span>;
                <span class="ActionScriptDefault_Text">wA</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">invIA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PY</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PX</span><span class="ActionScriptBracket/Brace">)</span>;<span class="ActionScriptComment">//invIA * b2Math.b2CrossVV(ccp.rA, P);
</span>                
                <span class="ActionScriptComment">//vB.Add( b2Math.MulFV( invMass2, P ) );
</span>                <span class="ActionScriptDefault_Text">vB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">invMassB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PX</span>;
                <span class="ActionScriptDefault_Text">vB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">invMassB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PY</span>;
                <span class="ActionScriptDefault_Text">wB</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">invIB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PY</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PX</span><span class="ActionScriptBracket/Brace">)</span>;<span class="ActionScriptComment">//invIB * b2Math.b2CrossVV(ccp.rB, P);
</span>                
                <span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">normalImpulse</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">newImpulse</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// Block solver developed in collaboration with Dirk Gregorius (back in 01/07 on Box2D_Lite).
</span>                <span class="ActionScriptComment">// Build the mini LCP for this contact patch
</span>                <span class="ActionScriptComment">//
</span>                <span class="ActionScriptComment">// vn = A * x + b, vn &gt;= 0, , vn &gt;= 0, x &gt;= 0 and vn_i * x_i = 0 with i = 1..2
</span>                <span class="ActionScriptComment">//
</span>                <span class="ActionScriptComment">// A = J * W * JT and J = ( -n, -r1 x n, n, r2 x n )
</span>                <span class="ActionScriptComment">// b = vn_0 - velocityBias
</span>                <span class="ActionScriptComment">//
</span>                <span class="ActionScriptComment">// The system is solved using the "Total enumeration method" (s. Murty). The complementary constraint vn_i * x_i
</span>                <span class="ActionScriptComment">// implies that we must have in any solution either vn_i = 0 or x_i = 0. So for the 2D contact problem the cases
</span>                <span class="ActionScriptComment">// vn1 = 0 and vn2 = 0, x1 = 0 and x2 = 0, x1 = 0 and vn2 = 0, x2 = 0 and vn1 = 0 need to be tested. The first valid
</span>                <span class="ActionScriptComment">// solution that satisfies the problem is chosen.
</span>                <span class="ActionScriptComment">//
</span>                <span class="ActionScriptComment">// In order to account of the accumulated impulse 'a' (because of the iterative nature of the solver which only requires
</span>                <span class="ActionScriptComment">// that the accumulated impulse is clamped and not the incremental impulse) we change the impulse variable (x_i).
</span>                <span class="ActionScriptComment">//
</span>                <span class="ActionScriptComment">// Substitute:
</span>                <span class="ActionScriptComment">//
</span>                <span class="ActionScriptComment">// x = x' - a
</span>                <span class="ActionScriptComment">//
</span>                <span class="ActionScriptComment">// Plug into above equation:
</span>                <span class="ActionScriptComment">//
</span>                <span class="ActionScriptComment">// vn = A * x + b
</span>                <span class="ActionScriptComment">//    = A * (x' - a) + b
</span>                <span class="ActionScriptComment">//    = A * x' + b - A * a
</span>                <span class="ActionScriptComment">//    = A * x' + b'
</span>                <span class="ActionScriptComment">// b' = b - A * a;
</span>                
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cp1</span>:<span class="ActionScriptDefault_Text">b2ContactConstraintPoint</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">points</span><span class="ActionScriptBracket/Brace">[</span> 0 <span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cp2</span>:<span class="ActionScriptDefault_Text">b2ContactConstraintPoint</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">points</span><span class="ActionScriptBracket/Brace">[</span> 1 <span class="ActionScriptBracket/Brace">]</span>;
                
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">aX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cp1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">normalImpulse</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">aY</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cp2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">normalImpulse</span>;
                <span class="ActionScriptComment">//b2Settings.b2Assert( aX &gt;= 0.0f &amp;&amp; aY &gt;= 0.0f );
</span>                
                <span class="ActionScriptComment">// Relative velocity at contact
</span>                <span class="ActionScriptComment">//var dv1:b2Vec2 = vB + b2Cross(wB, cp1.rB) - vA - b2Cross(wA, cp1.rA);
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dv1X</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">wB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cp1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">vA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">wA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cp1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dv1Y</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">wB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cp1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">vA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">wA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cp1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
                <span class="ActionScriptComment">//var dv2:b2Vec2 = vB + b2Cross(wB, cpB.r2) - vA - b2Cross(wA, cp2.rA);
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dv2X</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">wB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cp2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">vA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">wA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cp2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dv2Y</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">wB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cp2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">vA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">wA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cp2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
                
                <span class="ActionScriptComment">// Compute normal velocity
</span>                <span class="ActionScriptComment">//var vn1:Number = b2Dot(dv1, normal);
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vn1</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dv1X</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">normalX</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">dv1Y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">normalY</span>;
                <span class="ActionScriptComment">//var vn2:Number = b2Dot(dv2, normal);
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vn2</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dv2X</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">normalX</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">dv2Y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">normalY</span>;
                
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vn1</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">cp1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">velocityBias</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bY</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vn2</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">cp2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">velocityBias</span>;
                
                <span class="ActionScriptComment">//b -= b2Mul(c.K,a);
</span>                <span class="ActionScriptDefault_Text">tMat</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">K</span>;
                <span class="ActionScriptDefault_Text">bX</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">aX</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">aY</span>;
                <span class="ActionScriptDefault_Text">bY</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">aX</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">aY</span>;
                
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">k_errorTol</span>:<span class="ActionScriptDefault_Text">Number</span>  <span class="ActionScriptOperator">=</span> 0.001;
                <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span>;; <span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">//
</span>                    <span class="ActionScriptComment">// Case 1: vn = 0
</span>                    <span class="ActionScriptComment">//
</span>                    <span class="ActionScriptComment">// 0 = A * x' + b'
</span>                    <span class="ActionScriptComment">//
</span>                    <span class="ActionScriptComment">// Solve for x':
</span>                    <span class="ActionScriptComment">//
</span>                    <span class="ActionScriptComment">// x' = -inv(A) * b'
</span>                    <span class="ActionScriptComment">//
</span>                    
                    <span class="ActionScriptComment">//var x:b2Vec2 = - b2Mul(c-&gt;normalMass, b);
</span>                    <span class="ActionScriptDefault_Text">tMat</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">normalMass</span>;
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">xX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">bX</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">bY</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">xY</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">bX</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">bY</span><span class="ActionScriptBracket/Brace">)</span>;
                    
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">xX</span> <span class="ActionScriptOperator">&gt;=</span> 0.0 <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">xY</span> <span class="ActionScriptOperator">&gt;=</span> 0.0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptComment">// Resubstitute for the incremental impulse
</span>                        <span class="ActionScriptComment">//d = x - a;
</span>                        <span class="ActionScriptDefault_Text">dX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">xX</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">aX</span>;
                        <span class="ActionScriptDefault_Text">dY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">xY</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">aY</span>;
                        
                        <span class="ActionScriptComment">//Aply incremental impulse
</span>                        <span class="ActionScriptComment">//P1 = d.x * normal;
</span>                        <span class="ActionScriptDefault_Text">P1X</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dX</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">normalX</span>;
                        <span class="ActionScriptDefault_Text">P1Y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dX</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">normalY</span>;
                        <span class="ActionScriptComment">//P2 = d.y * normal;
</span>                        <span class="ActionScriptDefault_Text">P2X</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dY</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">normalX</span>;
                        <span class="ActionScriptDefault_Text">P2Y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dY</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">normalY</span>;
                        
                        <span class="ActionScriptComment">//vA -= invMass1 * (P1 + P2)
</span>                        <span class="ActionScriptDefault_Text">vA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">invMassA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">P1X</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">P2X</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">vA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">invMassA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">P1Y</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">P2Y</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptComment">//wA -= invIA * (b2Cross(cp1.rA, P1) + b2Cross(cp2.rA, P2));
</span>                        <span class="ActionScriptDefault_Text">wA</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">invIA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">cp1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">P1Y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">cp1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">P1X</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cp2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">P2Y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">cp2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">P2X</span><span class="ActionScriptBracket/Brace">)</span>;
                        
                        <span class="ActionScriptComment">//vB += invMassB * (P1 + P2)
</span>                        <span class="ActionScriptDefault_Text">vB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">invMassB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">P1X</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">P2X</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">vB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">invMassB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">P1Y</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">P2Y</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptComment">//wB += invIB * (b2Cross(cp1.rB, P1) + b2Cross(cp2.rB, P2));
</span>                        <span class="ActionScriptDefault_Text">wB</span>   <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">invIB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">cp1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">P1Y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">cp1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">P1X</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cp2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">P2Y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">cp2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">P2X</span><span class="ActionScriptBracket/Brace">)</span>;
                        
                        <span class="ActionScriptComment">// Accumulate
</span>                        <span class="ActionScriptDefault_Text">cp1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">normalImpulse</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">xX</span>;
                        <span class="ActionScriptDefault_Text">cp2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">normalImpulse</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">xY</span>;
                        
    <span class="ActionScriptComment">//#if B2_DEBUG_SOLVER == 1
</span>    <span class="ActionScriptComment">//                    // Post conditions
</span>    <span class="ActionScriptComment">//                    //dv1 = vB + b2Cross(wB, cp1.rB) - vA - b2Cross(wA, cp1.rA);
</span>    <span class="ActionScriptComment">//                    dv1X = vB.x - wB * cp1.rB.y - vA.x + wA * cp1.rA.y;
</span>    <span class="ActionScriptComment">//                    dv1Y = vB.y + wB * cp1.rB.x - vA.y - wA * cp1.rA.x;
</span>    <span class="ActionScriptComment">//                    //dv2 = vB + b2Cross(wB, cp2.rB) - vA - b2Cross(wA, cp2.rA);
</span>    <span class="ActionScriptComment">//                    dv1X = vB.x - wB * cp2.rB.y - vA.x + wA * cp2.rA.y;
</span>    <span class="ActionScriptComment">//                    dv1Y = vB.y + wB * cp2.rB.x - vA.y - wA * cp2.rA.x;
</span>    <span class="ActionScriptComment">//                    // Compute normal velocity
</span>    <span class="ActionScriptComment">//                    //vn1 = b2Dot(dv1, normal);
</span>    <span class="ActionScriptComment">//                    vn1 = dv1X * normalX + dv1Y * normalY;
</span>    <span class="ActionScriptComment">//                    //vn2 = b2Dot(dv2, normal);
</span>    <span class="ActionScriptComment">//                    vn2 = dv2X * normalX + dv2Y * normalY;
</span>    <span class="ActionScriptComment">//
</span>    <span class="ActionScriptComment">//                    //b2Settings.b2Assert(b2Abs(vn1 - cp1.velocityBias) &lt; k_errorTol);
</span>    <span class="ActionScriptComment">//                    //b2Settings.b2Assert(b2Abs(vn2 - cp2.velocityBias) &lt; k_errorTol);
</span>    <span class="ActionScriptComment">//#endif
</span>                        <span class="ActionScriptReserved">break</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                    
                    <span class="ActionScriptComment">//
</span>                    <span class="ActionScriptComment">// Case 2: vn1 = 0  and x2 = 0
</span>                    <span class="ActionScriptComment">//
</span>                    <span class="ActionScriptComment">//   0 = a11 * x1' + a12 * 0 + b1'
</span>                    <span class="ActionScriptComment">// vn2 = a21 * x1' + a22 * 0 + b2'
</span>                    <span class="ActionScriptComment">//
</span>                    
                    <span class="ActionScriptDefault_Text">xX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">cp1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">normalMass</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">bX</span>;
                    <span class="ActionScriptDefault_Text">xY</span> <span class="ActionScriptOperator">=</span> 0.0;
                    <span class="ActionScriptDefault_Text">vn1</span> <span class="ActionScriptOperator">=</span> 0.0;
                    <span class="ActionScriptDefault_Text">vn2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">K</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">xX</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">bY</span>;
                    
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">xX</span> <span class="ActionScriptOperator">&gt;=</span> 0.0 <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">vn2</span> <span class="ActionScriptOperator">&gt;=</span> 0.0<span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptComment">// Resubstitute for the incremental impulse
</span>                        <span class="ActionScriptComment">//d = x - a;
</span>                        <span class="ActionScriptDefault_Text">dX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">xX</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">aX</span>;
                        <span class="ActionScriptDefault_Text">dY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">xY</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">aY</span>;
                        
                        <span class="ActionScriptComment">//Aply incremental impulse
</span>                        <span class="ActionScriptComment">//P1 = d.x * normal;
</span>                        <span class="ActionScriptDefault_Text">P1X</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dX</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">normalX</span>;
                        <span class="ActionScriptDefault_Text">P1Y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dX</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">normalY</span>;
                        <span class="ActionScriptComment">//P2 = d.y * normal;
</span>                        <span class="ActionScriptDefault_Text">P2X</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dY</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">normalX</span>;
                        <span class="ActionScriptDefault_Text">P2Y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dY</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">normalY</span>;
                        
                        <span class="ActionScriptComment">//vA -= invMassA * (P1 + P2)
</span>                        <span class="ActionScriptDefault_Text">vA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">invMassA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">P1X</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">P2X</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">vA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">invMassA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">P1Y</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">P2Y</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptComment">//wA -= invIA * (b2Cross(cp1.rA, P1) + b2Cross(cp2.rA, P2));
</span>                        <span class="ActionScriptDefault_Text">wA</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">invIA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">cp1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">P1Y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">cp1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">P1X</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cp2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">P2Y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">cp2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">P2X</span><span class="ActionScriptBracket/Brace">)</span>;
                        
                        <span class="ActionScriptComment">//vB += invMassB * (P1 + P2)
</span>                        <span class="ActionScriptDefault_Text">vB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">invMassB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">P1X</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">P2X</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">vB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">invMassB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">P1Y</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">P2Y</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptComment">//wB += invIB * (b2Cross(cp1.rB, P1) + b2Cross(cp2.rB, P2));
</span>                        <span class="ActionScriptDefault_Text">wB</span>   <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">invIB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">cp1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">P1Y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">cp1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">P1X</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cp2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">P2Y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">cp2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">P2X</span><span class="ActionScriptBracket/Brace">)</span>;
                        
                        <span class="ActionScriptComment">// Accumulate
</span>                        <span class="ActionScriptDefault_Text">cp1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">normalImpulse</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">xX</span>;
                        <span class="ActionScriptDefault_Text">cp2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">normalImpulse</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">xY</span>;
                        
    <span class="ActionScriptComment">//#if B2_DEBUG_SOLVER == 1
</span>    <span class="ActionScriptComment">//                    // Post conditions
</span>    <span class="ActionScriptComment">//                    //dv1 = vB + b2Cross(wB, cp1.rB) - vA - b2Cross(wA, cp1.rA);
</span>    <span class="ActionScriptComment">//                    dv1X = vB.x - wB * cp1.rB.y - vA.x + wA * cp1.rA.y;
</span>    <span class="ActionScriptComment">//                    dv1Y = vB.y + wB * cp1.rB.x - vA.y - wA * cp1.rA.x;
</span>    <span class="ActionScriptComment">//                    //dv2 = vB + b2Cross(wB, cp2.rB) - vA - b2Cross(wA, cp2.rA);
</span>    <span class="ActionScriptComment">//                    dv1X = vB.x - wB * cp2.rB.y - vA.x + wA * cp2.rA.y;
</span>    <span class="ActionScriptComment">//                    dv1Y = vB.y + wB * cp2.rB.x - vA.y - wA * cp2.rA.x;
</span>    <span class="ActionScriptComment">//                    // Compute normal velocity
</span>    <span class="ActionScriptComment">//                    //vn1 = b2Dot(dv1, normal);
</span>    <span class="ActionScriptComment">//                    vn1 = dv1X * normalX + dv1Y * normalY;
</span>    <span class="ActionScriptComment">//                    //vn2 = b2Dot(dv2, normal);
</span>    <span class="ActionScriptComment">//                    vn2 = dv2X * normalX + dv2Y * normalY;
</span>    <span class="ActionScriptComment">//
</span>    <span class="ActionScriptComment">//                    //b2Settings.b2Assert(b2Abs(vn1 - cp1.velocityBias) &lt; k_errorTol);
</span>    <span class="ActionScriptComment">//                    //b2Settings.b2Assert(b2Abs(vn2 - cp2.velocityBias) &lt; k_errorTol);
</span>    <span class="ActionScriptComment">//#endif
</span>                        <span class="ActionScriptReserved">break</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                    
                    <span class="ActionScriptComment">//
</span>                    <span class="ActionScriptComment">// Case 3: wB = 0 and x1 = 0
</span>                    <span class="ActionScriptComment">//
</span>                    <span class="ActionScriptComment">// vn1 = a11 * 0 + a12 * x2' + b1'
</span>                    <span class="ActionScriptComment">//   0 = a21 * 0 + a22 * x2' + b2'
</span>                    <span class="ActionScriptComment">//
</span>                    
                    <span class="ActionScriptDefault_Text">xX</span> <span class="ActionScriptOperator">=</span> 0.0;
                    <span class="ActionScriptDefault_Text">xY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">cp2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">normalMass</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">bY</span>;
                    <span class="ActionScriptDefault_Text">vn1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">K</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">xY</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">bX</span>;
                    <span class="ActionScriptDefault_Text">vn2</span> <span class="ActionScriptOperator">=</span> 0.0;
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">xY</span> <span class="ActionScriptOperator">&gt;=</span> 0.0 <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">vn1</span> <span class="ActionScriptOperator">&gt;=</span> 0.0<span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptComment">// Resubstitute for the incremental impulse
</span>                        <span class="ActionScriptComment">//d = x - a;
</span>                        <span class="ActionScriptDefault_Text">dX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">xX</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">aX</span>;
                        <span class="ActionScriptDefault_Text">dY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">xY</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">aY</span>;
                        
                        <span class="ActionScriptComment">//Aply incremental impulse
</span>                        <span class="ActionScriptComment">//P1 = d.x * normal;
</span>                        <span class="ActionScriptDefault_Text">P1X</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dX</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">normalX</span>;
                        <span class="ActionScriptDefault_Text">P1Y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dX</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">normalY</span>;
                        <span class="ActionScriptComment">//P2 = d.y * normal;
</span>                        <span class="ActionScriptDefault_Text">P2X</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dY</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">normalX</span>;
                        <span class="ActionScriptDefault_Text">P2Y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dY</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">normalY</span>;
                        
                        <span class="ActionScriptComment">//vA -= invMassA * (P1 + P2)
</span>                        <span class="ActionScriptDefault_Text">vA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">invMassA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">P1X</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">P2X</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">vA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">invMassA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">P1Y</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">P2Y</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptComment">//wA -= invIA * (b2Cross(cp1.rA, P1) + b2Cross(cp2.rA, P2));
</span>                        <span class="ActionScriptDefault_Text">wA</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">invIA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">cp1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">P1Y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">cp1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">P1X</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cp2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">P2Y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">cp2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">P2X</span><span class="ActionScriptBracket/Brace">)</span>;
                        
                        <span class="ActionScriptComment">//vB += invMassB * (P1 + P2)
</span>                        <span class="ActionScriptDefault_Text">vB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">invMassB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">P1X</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">P2X</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">vB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">invMassB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">P1Y</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">P2Y</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptComment">//wB += invIB * (b2Cross(cp1.rB, P1) + b2Cross(cp2.rB, P2));
</span>                        <span class="ActionScriptDefault_Text">wB</span>   <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">invIB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">cp1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">P1Y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">cp1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">P1X</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cp2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">P2Y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">cp2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">P2X</span><span class="ActionScriptBracket/Brace">)</span>;
                        
                        <span class="ActionScriptComment">// Accumulate
</span>                        <span class="ActionScriptDefault_Text">cp1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">normalImpulse</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">xX</span>;
                        <span class="ActionScriptDefault_Text">cp2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">normalImpulse</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">xY</span>;
                        
    <span class="ActionScriptComment">//#if B2_DEBUG_SOLVER == 1
</span>    <span class="ActionScriptComment">//                    // Post conditions
</span>    <span class="ActionScriptComment">//                    //dv1 = vB + b2Cross(wB, cp1.rB) - vA - b2Cross(wA, cp1.rA);
</span>    <span class="ActionScriptComment">//                    dv1X = vB.x - wB * cp1.rB.y - vA.x + wA * cp1.rA.y;
</span>    <span class="ActionScriptComment">//                    dv1Y = vB.y + wB * cp1.rB.x - vA.y - wA * cp1.rA.x;
</span>    <span class="ActionScriptComment">//                    //dv2 = vB + b2Cross(wB, cp2.rB) - vA - b2Cross(wA, cp2.rA);
</span>    <span class="ActionScriptComment">//                    dv1X = vB.x - wB * cp2.rB.y - vA.x + wA * cp2.rA.y;
</span>    <span class="ActionScriptComment">//                    dv1Y = vB.y + wB * cp2.rB.x - vA.y - wA * cp2.rA.x;
</span>    <span class="ActionScriptComment">//                    // Compute normal velocity
</span>    <span class="ActionScriptComment">//                    //vn1 = b2Dot(dv1, normal);
</span>    <span class="ActionScriptComment">//                    vn1 = dv1X * normalX + dv1Y * normalY;
</span>    <span class="ActionScriptComment">//                    //vn2 = b2Dot(dv2, normal);
</span>    <span class="ActionScriptComment">//                    vn2 = dv2X * normalX + dv2Y * normalY;
</span>    <span class="ActionScriptComment">//
</span>    <span class="ActionScriptComment">//                    //b2Settings.b2Assert(b2Abs(vn1 - cp1.velocityBias) &lt; k_errorTol);
</span>    <span class="ActionScriptComment">//                    //b2Settings.b2Assert(b2Abs(vn2 - cp2.velocityBias) &lt; k_errorTol);
</span>    <span class="ActionScriptComment">//#endif
</span>                        <span class="ActionScriptReserved">break</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                    
                    <span class="ActionScriptComment">//
</span>                    <span class="ActionScriptComment">// Case 4: x1 = 0 and x2 = 0
</span>                    <span class="ActionScriptComment">//
</span>                    <span class="ActionScriptComment">// vn1 = b1
</span>                    <span class="ActionScriptComment">// vn2 = b2
</span>                    
                    <span class="ActionScriptDefault_Text">xX</span> <span class="ActionScriptOperator">=</span> 0.0;
                    <span class="ActionScriptDefault_Text">xY</span> <span class="ActionScriptOperator">=</span> 0.0;
                    <span class="ActionScriptDefault_Text">vn1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bX</span>;
                    <span class="ActionScriptDefault_Text">vn2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bY</span>;
                    
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vn1</span> <span class="ActionScriptOperator">&gt;=</span> 0.0 <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">vn2</span> <span class="ActionScriptOperator">&gt;=</span> 0.0 <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptComment">// Resubstitute for the incremental impulse
</span>                        <span class="ActionScriptComment">//d = x - a;
</span>                        <span class="ActionScriptDefault_Text">dX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">xX</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">aX</span>;
                        <span class="ActionScriptDefault_Text">dY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">xY</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">aY</span>;
                        
                        <span class="ActionScriptComment">//Aply incremental impulse
</span>                        <span class="ActionScriptComment">//P1 = d.x * normal;
</span>                        <span class="ActionScriptDefault_Text">P1X</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dX</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">normalX</span>;
                        <span class="ActionScriptDefault_Text">P1Y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dX</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">normalY</span>;
                        <span class="ActionScriptComment">//P2 = d.y * normal;
</span>                        <span class="ActionScriptDefault_Text">P2X</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dY</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">normalX</span>;
                        <span class="ActionScriptDefault_Text">P2Y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dY</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">normalY</span>;
                        
                        <span class="ActionScriptComment">//vA -= invMassA * (P1 + P2)
</span>                        <span class="ActionScriptDefault_Text">vA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">invMassA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">P1X</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">P2X</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">vA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">invMassA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">P1Y</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">P2Y</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptComment">//wA -= invIA * (b2Cross(cp1.rA, P1) + b2Cross(cp2.rA, P2));
</span>                        <span class="ActionScriptDefault_Text">wA</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">invIA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">cp1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">P1Y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">cp1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">P1X</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cp2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">P2Y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">cp2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">P2X</span><span class="ActionScriptBracket/Brace">)</span>;
                        
                        <span class="ActionScriptComment">//vB += invMassB * (P1 + P2)
</span>                        <span class="ActionScriptDefault_Text">vB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">invMassB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">P1X</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">P2X</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">vB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">invMassB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">P1Y</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">P2Y</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptComment">//wB += invIB * (b2Cross(cp1.rB, P1) + b2Cross(cp2.rB, P2));
</span>                        <span class="ActionScriptDefault_Text">wB</span>   <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">invIB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">cp1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">P1Y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">cp1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">P1X</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cp2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">P2Y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">cp2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">P2X</span><span class="ActionScriptBracket/Brace">)</span>;
                        
                        <span class="ActionScriptComment">// Accumulate
</span>                        <span class="ActionScriptDefault_Text">cp1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">normalImpulse</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">xX</span>;
                        <span class="ActionScriptDefault_Text">cp2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">normalImpulse</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">xY</span>;
                        
    <span class="ActionScriptComment">//#if B2_DEBUG_SOLVER == 1
</span>    <span class="ActionScriptComment">//                    // Post conditions
</span>    <span class="ActionScriptComment">//                    //dv1 = vB + b2Cross(wB, cp1.rB) - vA - b2Cross(wA, cp1.rA);
</span>    <span class="ActionScriptComment">//                    dv1X = vB.x - wB * cp1.rB.y - vA.x + wA * cp1.rA.y;
</span>    <span class="ActionScriptComment">//                    dv1Y = vB.y + wB * cp1.rB.x - vA.y - wA * cp1.rA.x;
</span>    <span class="ActionScriptComment">//                    //dv2 = vB + b2Cross(wB, cp2.rB) - vA - b2Cross(wA, cp2.rA);
</span>    <span class="ActionScriptComment">//                    dv1X = vB.x - wB * cp2.rB.y - vA.x + wA * cp2.rA.y;
</span>    <span class="ActionScriptComment">//                    dv1Y = vB.y + wB * cp2.rB.x - vA.y - wA * cp2.rA.x;
</span>    <span class="ActionScriptComment">//                    // Compute normal velocity
</span>    <span class="ActionScriptComment">//                    //vn1 = b2Dot(dv1, normal);
</span>    <span class="ActionScriptComment">//                    vn1 = dv1X * normalX + dv1Y * normalY;
</span>    <span class="ActionScriptComment">//                    //vn2 = b2Dot(dv2, normal);
</span>    <span class="ActionScriptComment">//                    vn2 = dv2X * normalX + dv2Y * normalY;
</span>    <span class="ActionScriptComment">//
</span>    <span class="ActionScriptComment">//                    //b2Settings.b2Assert(b2Abs(vn1 - cp1.velocityBias) &lt; k_errorTol);
</span>    <span class="ActionScriptComment">//                    //b2Settings.b2Assert(b2Abs(vn2 - cp2.velocityBias) &lt; k_errorTol);
</span>    <span class="ActionScriptComment">//#endif
</span>                        <span class="ActionScriptReserved">break</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                    
                    <span class="ActionScriptComment">// No solution, give up. This is hit sometimes, but it doesn't seem to matter.
</span>                    <span class="ActionScriptReserved">break</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            
            
            <span class="ActionScriptComment">// b2Vec2s in AS3 are copied by reference. The originals are 
</span>            <span class="ActionScriptComment">// references to the same things here and there is no need to 
</span>            <span class="ActionScriptComment">// copy them back, unlike in C++ land where b2Vec2s are 
</span>            <span class="ActionScriptComment">// copied by value.
</span>            <span class="ActionScriptComment">/*bodyA-&gt;m_linearVelocity = vA;
            bodyB-&gt;m_linearVelocity = vB;*/</span>
            <span class="ActionScriptDefault_Text">bodyA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_angularVelocity</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">wA</span>;
            <span class="ActionScriptDefault_Text">bodyB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_angularVelocity</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">wB</span>;
        <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>
    
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">FinalizeVelocityConstraints</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">m_constraintCount</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">c</span>:<span class="ActionScriptDefault_Text">b2ContactConstraint</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_constraints</span><span class="ActionScriptBracket/Brace">[</span> <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m</span>:<span class="ActionScriptDefault_Text">b2Manifold</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">manifold</span>;
            
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">j</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">pointCount</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">point1</span>:<span class="ActionScriptDefault_Text">b2ManifoldPoint</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_points</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">point2</span>:<span class="ActionScriptDefault_Text">b2ContactConstraintPoint</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">points</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">point1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_normalImpulse</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">point2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">normalImpulse</span>;
                <span class="ActionScriptDefault_Text">point1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_tangentImpulse</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">point2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">tangentImpulse</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>
    
<span class="ActionScriptComment">//#if 1
</span><span class="ActionScriptComment">// Sequential solver
</span><span class="ActionScriptComment">//    public function SolvePositionConstraints(baumgarte:Number):Boolean{
</span><span class="ActionScriptComment">//        var minSeparation:Number = 0.0;
</span><span class="ActionScriptComment">//        
</span><span class="ActionScriptComment">//        var tMat:b2Mat22;
</span><span class="ActionScriptComment">//        var tVec:b2Vec2;
</span><span class="ActionScriptComment">//        
</span><span class="ActionScriptComment">//        for (var i:int = 0; i &lt; m_constraintCount; ++i)
</span><span class="ActionScriptComment">//        {
</span><span class="ActionScriptComment">//            var c:b2ContactConstraint = m_constraints[ i ];
</span><span class="ActionScriptComment">//            var bodyA:b2Body = c.bodyA;
</span><span class="ActionScriptComment">//            var bodyB:b2Body = c.bodyB;
</span><span class="ActionScriptComment">//            var bA_sweep_c:b2Vec2 = bodyA.m_sweep.c;
</span><span class="ActionScriptComment">//            var bA_sweep_a:Number = bodyA.m_sweep.a;
</span><span class="ActionScriptComment">//            var bB_sweep_c:b2Vec2 = bodyB.m_sweep.c;
</span><span class="ActionScriptComment">//            var bB_sweep_a:Number = bodyB.m_sweep.a;
</span><span class="ActionScriptComment">//            
</span><span class="ActionScriptComment">//            var invMassa:Number = bodyA.m_mass * bodyA.m_invMass;
</span><span class="ActionScriptComment">//            var invIa:Number = bodyA.m_mass * bodyA.m_invI;
</span><span class="ActionScriptComment">//            var invMassb:Number = bodyB.m_mass * bodyB.m_invMass;
</span><span class="ActionScriptComment">//            var invIb:Number = bodyB.m_mass * bodyB.m_invI;
</span><span class="ActionScriptComment">//            //var normal:b2Vec2 = new b2Vec2(c.normal.x, c.normal.y);
</span><span class="ActionScriptComment">//            var normalX:Number = c.normal.x;
</span><span class="ActionScriptComment">//            var normalY:Number = c.normal.y;
</span><span class="ActionScriptComment">//            
</span><span class="ActionScriptComment">//            // Solver normal constraints
</span><span class="ActionScriptComment">//            var tCount:int = c.pointCount;
</span><span class="ActionScriptComment">//            for (var j:int = 0; j &lt; tCount; ++j)
</span><span class="ActionScriptComment">//            {
</span><span class="ActionScriptComment">//                var ccp:b2ContactConstraintPoint = c.points[ j ];
</span><span class="ActionScriptComment">//                
</span><span class="ActionScriptComment">//                //r1 = b2Mul(bodyA-&gt;m_xf.R, ccp-&gt;localAnchor1 - bodyA-&gt;GetLocalCenter());
</span><span class="ActionScriptComment">//                tMat = bodyA.m_xf.R;
</span><span class="ActionScriptComment">//                tVec = bodyA.m_sweep.localCenter;
</span><span class="ActionScriptComment">//                var r1X:Number = ccp.localAnchor1.x - tVec.x;
</span><span class="ActionScriptComment">//                var r1Y:Number = ccp.localAnchor1.y - tVec.y;
</span><span class="ActionScriptComment">//                tX =  (tMat.col1.x * r1X + tMat.col2.x * r1Y);
</span><span class="ActionScriptComment">//                r1Y = (tMat.col1.y * r1X + tMat.col2.y * r1Y);
</span><span class="ActionScriptComment">//                r1X = tX;
</span><span class="ActionScriptComment">//                
</span><span class="ActionScriptComment">//                //r2 = b2Mul(bodyB-&gt;m_xf.R, ccp-&gt;localAnchor2 - bodyB-&gt;GetLocalCenter());
</span><span class="ActionScriptComment">//                tMat = bodyB.m_xf.R;
</span><span class="ActionScriptComment">//                tVec = bodyB.m_sweep.localCenter;
</span><span class="ActionScriptComment">//                var r2X:Number = ccp.localAnchor2.x - tVec.x;
</span><span class="ActionScriptComment">//                var r2Y:Number = ccp.localAnchor2.y - tVec.y;
</span><span class="ActionScriptComment">//                var tX:Number =  (tMat.col1.x * r2X + tMat.col2.x * r2Y);
</span><span class="ActionScriptComment">//                r2Y =              (tMat.col1.y * r2X + tMat.col2.y * r2Y);
</span><span class="ActionScriptComment">//                r2X = tX;
</span><span class="ActionScriptComment">//                
</span><span class="ActionScriptComment">//                //b2Vec2 p1 = bodyA-&gt;m_sweep.c + r1;
</span><span class="ActionScriptComment">//                var p1X:Number = b1_sweep_c.x + r1X;
</span><span class="ActionScriptComment">//                var p1Y:Number = b1_sweep_c.y + r1Y;
</span><span class="ActionScriptComment">//                
</span><span class="ActionScriptComment">//                //b2Vec2 p2 = bodyB-&gt;m_sweep.c + r2;
</span><span class="ActionScriptComment">//                var p2X:Number = b2_sweep_c.x + r2X;
</span><span class="ActionScriptComment">//                var p2Y:Number = b2_sweep_c.y + r2Y;
</span><span class="ActionScriptComment">//                
</span><span class="ActionScriptComment">//                //var dp:b2Vec2 = b2Math.SubtractVV(p2, p1);
</span><span class="ActionScriptComment">//                var dpX:Number = p2X - p1X;
</span><span class="ActionScriptComment">//                var dpY:Number = p2Y - p1Y;
</span><span class="ActionScriptComment">//                
</span><span class="ActionScriptComment">//                // Approximate the current separation.
</span><span class="ActionScriptComment">//                //var separation:Number = b2Math.b2Dot(dp, normal) + ccp.separation;
</span><span class="ActionScriptComment">//                var separation:Number = (dpX*normalX + dpY*normalY) + ccp.separation;
</span><span class="ActionScriptComment">//                
</span><span class="ActionScriptComment">//                // Track max constraint error.
</span><span class="ActionScriptComment">//                minSeparation = b2Math.b2Min(minSeparation, separation);
</span><span class="ActionScriptComment">//                
</span><span class="ActionScriptComment">//                // Prevent large corrections and allow slop.
</span><span class="ActionScriptComment">//                var C:Number =  b2Math.b2Clamp(baumgarte * (separation + b2Settings.b2_linearSlop), -b2Settings.b2_maxLinearCorrection, 0.0);
</span><span class="ActionScriptComment">//                
</span><span class="ActionScriptComment">//                // Compute normal impulse
</span><span class="ActionScriptComment">//                var dImpulse:Number = -ccp.equalizedMass * C;
</span><span class="ActionScriptComment">//                
</span><span class="ActionScriptComment">//                //var P:b2Vec2 = b2Math.MulFV( dImpulse, normal );
</span><span class="ActionScriptComment">//                var PX:Number = dImpulse * normalX;
</span><span class="ActionScriptComment">//                var PY:Number = dImpulse * normalY;
</span><span class="ActionScriptComment">//                
</span><span class="ActionScriptComment">//                //bodyA.m_position.Subtract( b2Math.MulFV( invMass1, impulse ) );
</span><span class="ActionScriptComment">//                b1_sweep_c.x -= invMass1 * PX;
</span><span class="ActionScriptComment">//                b1_sweep_c.y -= invMass1 * PY;
</span><span class="ActionScriptComment">//                b1_sweep_a -= invI1 * (r1X * PY - r1Y * PX);//b2Math.b2CrossVV(r1, P);
</span><span class="ActionScriptComment">//                bodyA.m_sweep.a = b1_sweep_a;
</span><span class="ActionScriptComment">//                bodyA.SynchronizeTransform();
</span><span class="ActionScriptComment">//                
</span><span class="ActionScriptComment">//                //bodyB.m_position.Add( b2Math.MulFV( invMass2, P ) );
</span><span class="ActionScriptComment">//                b2_sweep_c.x += invMass2 * PX;
</span><span class="ActionScriptComment">//                b2_sweep_c.y += invMass2 * PY;
</span><span class="ActionScriptComment">//                b2_sweep_a += invI2 * (r2X * PY - r2Y * PX);//b2Math.b2CrossVV(r2, P);
</span><span class="ActionScriptComment">//                bodyB.m_sweep.a = b2_sweep_a;
</span><span class="ActionScriptComment">//                bodyB.SynchronizeTransform();
</span><span class="ActionScriptComment">//            }
</span><span class="ActionScriptComment">//            // Update body rotations
</span><span class="ActionScriptComment">//            //bodyA.m_sweep.a = b1_sweep_a;
</span><span class="ActionScriptComment">//            //bodyB.m_sweep.a = b2_sweep_a;
</span><span class="ActionScriptComment">//        }
</span><span class="ActionScriptComment">//        
</span><span class="ActionScriptComment">//        // We can't expect minSpeparation &gt;= -b2_linearSlop because we don't
</span><span class="ActionScriptComment">//        // push the separation above -b2_linearSlop.
</span><span class="ActionScriptComment">//        return minSeparation &gt;= -1.5 * b2Settings.b2_linearSlop;
</span><span class="ActionScriptComment">//    }
</span><span class="ActionScriptComment">//#else
</span>    <span class="ActionScriptComment">// Sequential solver.
</span>    <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">s_psm</span>:<span class="ActionScriptDefault_Text">b2PositionSolverManifold</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">b2PositionSolverManifold</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">SolvePositionConstraints</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">baumgarte</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Boolean</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">minSeparation</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0.0;
        
        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">m_constraintCount</span>; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">c</span>:<span class="ActionScriptDefault_Text">b2ContactConstraint</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_constraints</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bodyA</span>:<span class="ActionScriptDefault_Text">b2Body</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bodyA</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bodyB</span>:<span class="ActionScriptDefault_Text">b2Body</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">bodyB</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">invMassA</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bodyA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_mass</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">bodyA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invMass</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">invIA</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bodyA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_mass</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">bodyA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invI</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">invMassB</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bodyB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_mass</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">bodyB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invMass</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">invIB</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bodyB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_mass</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">bodyB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invI</span>;
            
            
            <span class="ActionScriptDefault_Text">s_psm</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Initialize</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">c</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">normal</span>:<span class="ActionScriptDefault_Text">b2Vec2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">s_psm</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_normal</span>;
            
            <span class="ActionScriptComment">// Solve normal constraints
</span>            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">j</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">pointCount</span>; <span class="ActionScriptDefault_Text">j</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ccp</span>:<span class="ActionScriptDefault_Text">b2ContactConstraintPoint</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">points</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptBracket/Brace">]</span>;
                
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">point</span>:<span class="ActionScriptDefault_Text">b2Vec2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">s_psm</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_points</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">separation</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">s_psm</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_separations</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptBracket/Brace">]</span>;
                
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rAX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">point</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">bodyA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_sweep</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rAY</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">point</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">bodyA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_sweep</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rBX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">point</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">bodyB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_sweep</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rBY</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">point</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">bodyB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_sweep</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
                
                <span class="ActionScriptComment">// Track max constraint error.
</span>                <span class="ActionScriptDefault_Text">minSeparation</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">minSeparation</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">separation</span><span class="ActionScriptOperator">?</span><span class="ActionScriptDefault_Text">minSeparation</span>:<span class="ActionScriptDefault_Text">separation</span>;
                
                <span class="ActionScriptComment">// Prevent large corrections and allow slop.
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">C</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">b2Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Clamp</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">baumgarte</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">separation</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">b2Settings</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">b2_linearSlop</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">b2Settings</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">b2_maxLinearCorrection</span><span class="ActionScriptOperator">,</span> 0.0<span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptComment">// Compute normal impulse
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">impulse</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">ccp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">equalizedMass</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">C</span>;
                
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">PX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">impulse</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">normal</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">PY</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">impulse</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">normal</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
                
                <span class="ActionScriptComment">//bodyA.m_sweep.c -= invMassA * P;
</span>                <span class="ActionScriptDefault_Text">bodyA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_sweep</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">invMassA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PX</span>;
                <span class="ActionScriptDefault_Text">bodyA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_sweep</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">invMassA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PY</span>;
                <span class="ActionScriptComment">//bodyA.m_sweep.a -= invIA * b2Cross(rA, P);
</span>                <span class="ActionScriptDefault_Text">bodyA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_sweep</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">a</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">invIA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">rAX</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PY</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">rAY</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PX</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">bodyA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SynchronizeTransform</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptComment">//bodyB.m_sweep.c += invMassB * P;
</span>                <span class="ActionScriptDefault_Text">bodyB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_sweep</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">invMassB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PX</span>;
                <span class="ActionScriptDefault_Text">bodyB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_sweep</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">invMassB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PY</span>;
                <span class="ActionScriptComment">//bodyB.m_sweep.a += invIB * b2Cross(rB, P);
</span>                <span class="ActionScriptDefault_Text">bodyB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_sweep</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">a</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">invIB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">rBX</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PY</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">rBY</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PX</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">bodyB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SynchronizeTransform</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptComment">// We can't expect minSpeparation &gt;= -b2_linearSlop because we don't
</span>        <span class="ActionScriptComment">// push the separation above -b2_linearSlop.
</span>        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">minSeparation</span> <span class="ActionScriptOperator">&gt;</span> <span class="ActionScriptOperator">-</span>1.5 <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">b2Settings</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">b2_linearSlop</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    
<span class="ActionScriptComment">//#endif
</span>    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m_step</span>:<span class="ActionScriptDefault_Text">b2TimeStep</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">b2TimeStep</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m_allocator</span>:<span class="ActionScriptOperator">*</span>;
    <span class="ActionScriptDefault_Text">b2internal</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m_constraints</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">b2ContactConstraint</span><span class="ActionScriptBracket/Brace">&gt;</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">b2ContactConstraint</span><span class="ActionScriptBracket/Brace">&gt;</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m_constraintCount</span>:<span class="ActionScriptDefault_Text">int</span>;
<span class="ActionScriptBracket/Brace">}</span>;

<span class="ActionScriptBracket/Brace">}</span></pre></body>
</html>
