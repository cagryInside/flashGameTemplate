<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>b2GearJoint.as</title>
<link rel="stylesheet" type="text/css" href="../../../../../../SourceStyles.css"/>
</head>

<body><pre><span class="ActionScriptComment">/*
* Copyright (c) 2006-2007 Erin Catto http://www.gphysics.com
*
* This software is provided 'as-is', without any express or implied
* warranty.  In no event will the authors be held liable for any damages
* arising from the use of this software.
* Permission is granted to anyone to use this software for any purpose,
* including commercial applications, and to alter it and redistribute it
* freely, subject to the following restrictions:
* 1. The origin of this software must not be misrepresented; you must not
* claim that you wrote the original software. If you use this software
* in a product, an acknowledgment in the product documentation would be
* appreciated but is not required.
* 2. Altered source versions must be plainly marked as such, and must not be
* misrepresented as being the original software.
* 3. This notice may not be removed or altered from any source distribution.
*/</span>

<span class="ActionScriptpackage">package</span> <span class="ActionScriptDefault_Text">Box2D</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Dynamics</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Joints</span><span class="ActionScriptBracket/Brace">{</span>
    
    
    
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">Box2D</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Common</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">*</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">Box2D</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Common</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">*</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">Box2D</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Dynamics</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">*</span>;

<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">Box2D</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Common</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">b2internal</span>;
<span class="ActionScriptReserved">use</span> <span class="ActionScriptReserved">namespace</span> <span class="ActionScriptDefault_Text">b2internal</span>;




<span class="ActionScriptASDoc">/**
* A gear joint is used to connect two joints together. Either joint
* can be a revolute or prismatic joint. You specify a gear ratio
* to bind the motions together:
* coordinate1 + ratio * coordinate2 = constant
* The ratio can be negative or positive. If one joint is a revolute joint
* and the other joint is a prismatic joint, then the ratio will have units
* of length or units of 1/length.
* @warning The revolute and prismatic joints must be attached to
* fixed bodies (which must be body1 on those joints).
* @see b2GearJointDef
*/</span>

<span class="ActionScriptReserved">public</span> <span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">b2GearJoint</span> <span class="ActionScriptReserved">extends</span> <span class="ActionScriptDefault_Text">b2Joint</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptASDoc">/** @inheritDoc */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">GetAnchorA</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptComment">//return m_bodyA-&gt;GetWorldPoint(m_localAnchor1);
</span>        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">m_bodyA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">GetWorldPoint</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_localAnchor1</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptASDoc">/** @inheritDoc */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">GetAnchorB</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptComment">//return m_bodyB-&gt;GetWorldPoint(m_localAnchor2);
</span>        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">m_bodyB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">GetWorldPoint</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_localAnchor2</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptASDoc">/** @inheritDoc */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">GetReactionForce</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">inv_dt</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptComment">// TODO_ERIN not tested
</span>        <span class="ActionScriptComment">// b2Vec2 P = m_impulse * m_J.linear2;
</span>        <span class="ActionScriptComment">//return inv_dt * P;
</span>        <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">inv_dt</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_impulse</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_J</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">linearB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">inv_dt</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_impulse</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_J</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">linearB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptASDoc">/** @inheritDoc */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">GetReactionTorque</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">inv_dt</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptComment">// TODO_ERIN not tested
</span>        <span class="ActionScriptComment">//b2Vec2 r = b2Mul(m_bodyB-&gt;m_xf.R, m_localAnchor2 - m_bodyB-&gt;GetLocalCenter());
</span>        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tMat</span>:<span class="ActionScriptDefault_Text">b2Mat22</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_bodyB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_xf</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">R</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_localAnchor1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">m_bodyB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_sweep</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">localCenter</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rY</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_localAnchor1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">m_bodyB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_sweep</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">localCenter</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">rX</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">rY</span>;
        <span class="ActionScriptDefault_Text">rY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">rX</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">rY</span>;
        <span class="ActionScriptDefault_Text">rX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tX</span>;
        <span class="ActionScriptComment">//b2Vec2 P = m_impulse * m_J.linearB;
</span>        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">PX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_impulse</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_J</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">linearB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">PY</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_impulse</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_J</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">linearB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
        <span class="ActionScriptComment">//float32 L = m_impulse * m_J.angularB - b2Cross(r, P);
</span>        <span class="ActionScriptComment">//return inv_dt * L;
</span>        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">inv_dt</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_impulse</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_J</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">angularB</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">rX</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PY</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">rY</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PX</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptASDoc">/**
     * Get the gear ratio.
     */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">GetRatio</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">m_ratio</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    
    <span class="ActionScriptASDoc">/**
     * Set the gear ratio.
     */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">SetRatio</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ratio</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptComment">//b2Settings.b2Assert(b2Math.b2IsValid(ratio));
</span>        <span class="ActionScriptDefault_Text">m_ratio</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ratio</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptComment">//--------------- Internals Below -------------------
</span>
    <span class="ActionScriptASDoc">/** @private */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">b2GearJoint</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">def</span>:<span class="ActionScriptDefault_Text">b2GearJointDef</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptComment">// parent constructor
</span>        <span class="ActionScriptReserved">super</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">def</span><span class="ActionScriptBracket/Brace">)</span>;
        
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">type1</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">def</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">joint1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_type</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">type2</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">def</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">joint2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_type</span>;
        
        <span class="ActionScriptComment">//b2Settings.b2Assert(type1 == b2Joint.e_revoluteJoint || type1 == b2Joint.e_prismaticJoint);
</span>        <span class="ActionScriptComment">//b2Settings.b2Assert(type2 == b2Joint.e_revoluteJoint || type2 == b2Joint.e_prismaticJoint);
</span>        <span class="ActionScriptComment">//b2Settings.b2Assert(def.joint1.GetBodyA().GetType() == b2Body.b2_staticBody);
</span>        <span class="ActionScriptComment">//b2Settings.b2Assert(def.joint2.GetBodyA().GetType() == b2Body.b2_staticBody);
</span>        
        <span class="ActionScriptDefault_Text">m_revolute1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
        <span class="ActionScriptDefault_Text">m_prismatic1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
        <span class="ActionScriptDefault_Text">m_revolute2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
        <span class="ActionScriptDefault_Text">m_prismatic2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
        
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">coordinate1</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">coordinate2</span>:<span class="ActionScriptDefault_Text">Number</span>;
        
        <span class="ActionScriptDefault_Text">m_ground1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">def</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">joint1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">GetBodyA</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">m_bodyA</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">def</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">joint1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">GetBodyB</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">type1</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">b2Joint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">e_revoluteJoint</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">m_revolute1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">def</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">joint1</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">b2RevoluteJoint</span>;
            <span class="ActionScriptDefault_Text">m_groundAnchor1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetV</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">m_revolute1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_localAnchor1</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">m_localAnchor1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetV</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">m_revolute1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_localAnchor2</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">coordinate1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_revolute1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">GetJointAngle</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">else</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">m_prismatic1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">def</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">joint1</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">b2PrismaticJoint</span>;
            <span class="ActionScriptDefault_Text">m_groundAnchor1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetV</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">m_prismatic1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_localAnchor1</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">m_localAnchor1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetV</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">m_prismatic1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_localAnchor2</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">coordinate1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_prismatic1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">GetJointTranslation</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptDefault_Text">m_ground2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">def</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">joint2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">GetBodyA</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">m_bodyB</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">def</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">joint2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">GetBodyB</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">type2</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">b2Joint</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">e_revoluteJoint</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">m_revolute2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">def</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">joint2</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">b2RevoluteJoint</span>;
            <span class="ActionScriptDefault_Text">m_groundAnchor2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetV</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">m_revolute2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_localAnchor1</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">m_localAnchor2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetV</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">m_revolute2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_localAnchor2</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">coordinate2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_revolute2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">GetJointAngle</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">else</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">m_prismatic2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">def</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">joint2</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">b2PrismaticJoint</span>;
            <span class="ActionScriptDefault_Text">m_groundAnchor2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetV</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">m_prismatic2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_localAnchor1</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">m_localAnchor2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetV</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">m_prismatic2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_localAnchor2</span> <span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">coordinate2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_prismatic2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">GetJointTranslation</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptDefault_Text">m_ratio</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">def</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ratio</span>;
        
        <span class="ActionScriptDefault_Text">m_constant</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">coordinate1</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">m_ratio</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">coordinate2</span>;
        
        <span class="ActionScriptDefault_Text">m_impulse</span> <span class="ActionScriptOperator">=</span> 0.0;
        
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptDefault_Text">b2internal</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">InitVelocityConstraints</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">step</span>:<span class="ActionScriptDefault_Text">b2TimeStep</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span><span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">g1</span>:<span class="ActionScriptDefault_Text">b2Body</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_ground1</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">g2</span>:<span class="ActionScriptDefault_Text">b2Body</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_ground2</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bA</span>:<span class="ActionScriptDefault_Text">b2Body</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_bodyA</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bB</span>:<span class="ActionScriptDefault_Text">b2Body</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_bodyB</span>;
        
        <span class="ActionScriptComment">// temp vars
</span>        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ugX</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ugY</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rX</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rY</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tMat</span>:<span class="ActionScriptDefault_Text">b2Mat22</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tVec</span>:<span class="ActionScriptDefault_Text">b2Vec2</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">crug</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tX</span>:<span class="ActionScriptDefault_Text">Number</span>;
        
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">K</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0.0;
        <span class="ActionScriptDefault_Text">m_J</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetZero</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        
        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_revolute1</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">m_J</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">angularA</span> <span class="ActionScriptOperator">=</span> -1.0;
            <span class="ActionScriptDefault_Text">K</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invI</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">else</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">//b2Vec2 ug = b2MulMV(g1-&gt;m_xf.R, m_prismatic1-&gt;m_localXAxis1);
</span>            <span class="ActionScriptDefault_Text">tMat</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">g1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_xf</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">R</span>;
            <span class="ActionScriptDefault_Text">tVec</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_prismatic1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_localXAxis1</span>;
            <span class="ActionScriptDefault_Text">ugX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">tVec</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">tVec</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
            <span class="ActionScriptDefault_Text">ugY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">tVec</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">tVec</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
            <span class="ActionScriptComment">//b2Vec2 r = b2Mul(bA-&gt;m_xf.R, m_localAnchor1 - bA-&gt;GetLocalCenter());
</span>            <span class="ActionScriptDefault_Text">tMat</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_xf</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">R</span>;
            <span class="ActionScriptDefault_Text">rX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_localAnchor1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_sweep</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">localCenter</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
            <span class="ActionScriptDefault_Text">rY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_localAnchor1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_sweep</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">localCenter</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
            <span class="ActionScriptDefault_Text">tX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">rX</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">rY</span>;
            <span class="ActionScriptDefault_Text">rY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">rX</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">rY</span>;
            <span class="ActionScriptDefault_Text">rX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tX</span>;
            
            <span class="ActionScriptComment">//var crug:Number = b2Cross(r, ug);
</span>            <span class="ActionScriptDefault_Text">crug</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">rX</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">ugY</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">rY</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">ugX</span>;
            <span class="ActionScriptComment">//m_J.linearA = -ug;
</span>            <span class="ActionScriptDefault_Text">m_J</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">linearA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Set</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">ugX</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">ugY</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">m_J</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">angularA</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">crug</span>;
            <span class="ActionScriptDefault_Text">K</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invMass</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invI</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">crug</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">crug</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_revolute2</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">m_J</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">angularB</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">m_ratio</span>;
            <span class="ActionScriptDefault_Text">K</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">m_ratio</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_ratio</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invI</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">else</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">//b2Vec2 ug = b2Mul(g2-&gt;m_xf.R, m_prismatic2-&gt;m_localXAxis1);
</span>            <span class="ActionScriptDefault_Text">tMat</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">g2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_xf</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">R</span>;
            <span class="ActionScriptDefault_Text">tVec</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_prismatic2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_localXAxis1</span>;
            <span class="ActionScriptDefault_Text">ugX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">tVec</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">tVec</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
            <span class="ActionScriptDefault_Text">ugY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">tVec</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">tVec</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
            <span class="ActionScriptComment">//b2Vec2 r = b2Mul(bB-&gt;m_xf.R, m_localAnchor2 - bB-&gt;GetLocalCenter());
</span>            <span class="ActionScriptDefault_Text">tMat</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_xf</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">R</span>;
            <span class="ActionScriptDefault_Text">rX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_localAnchor2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_sweep</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">localCenter</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
            <span class="ActionScriptDefault_Text">rY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_localAnchor2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_sweep</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">localCenter</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
            <span class="ActionScriptDefault_Text">tX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">rX</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">rY</span>;
            <span class="ActionScriptDefault_Text">rY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">rX</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">rY</span>;
            <span class="ActionScriptDefault_Text">rX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tX</span>;
            
            <span class="ActionScriptComment">//float32 crug = b2Cross(r, ug);
</span>            <span class="ActionScriptDefault_Text">crug</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">rX</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">ugY</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">rY</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">ugX</span>;
            <span class="ActionScriptComment">//m_J.linearB = -m_ratio * ug;
</span>            <span class="ActionScriptDefault_Text">m_J</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">linearB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Set</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">m_ratio</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">ugX</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">m_ratio</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">ugY</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">m_J</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">angularB</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">m_ratio</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">crug</span>;
            <span class="ActionScriptDefault_Text">K</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">m_ratio</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_ratio</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invMass</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invI</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">crug</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">crug</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptComment">// Compute effective mass.
</span>        <span class="ActionScriptDefault_Text">m_mass</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">K</span> <span class="ActionScriptOperator">&gt;</span> 0.0<span class="ActionScriptOperator">?</span>1.0 <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">K</span>:0.0;
        
        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">step</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">warmStarting</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">// Warm starting.
</span>            <span class="ActionScriptComment">//bA.m_linearVelocity += bA.m_invMass * m_impulse * m_J.linearA;
</span>            <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_linearVelocity</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invMass</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_impulse</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_J</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">linearA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
            <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_linearVelocity</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invMass</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_impulse</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_J</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">linearA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
            <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_angularVelocity</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invI</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_impulse</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_J</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">angularA</span>;
            <span class="ActionScriptComment">//bB.m_linearVelocity += bB.m_invMass * m_impulse * m_J.linearB;
</span>            <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_linearVelocity</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invMass</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_impulse</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_J</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">linearB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
            <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_linearVelocity</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invMass</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_impulse</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_J</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">linearB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
            <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_angularVelocity</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invI</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_impulse</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_J</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">angularB</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">else</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">m_impulse</span> <span class="ActionScriptOperator">=</span> 0.0;
        <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>
    
    <span class="ActionScriptDefault_Text">b2internal</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">SolveVelocityConstraints</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">step</span>:<span class="ActionScriptDefault_Text">b2TimeStep</span><span class="ActionScriptBracket/Brace">)</span>: <span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptComment">//B2_NOT_USED(step);
</span>        
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bA</span>:<span class="ActionScriptDefault_Text">b2Body</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_bodyA</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bB</span>:<span class="ActionScriptDefault_Text">b2Body</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_bodyB</span>;
        
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">Cdot</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_J</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Compute</span><span class="ActionScriptBracket/Brace">(</span>    <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_linearVelocity</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_angularVelocity</span><span class="ActionScriptOperator">,</span>
                                        <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_linearVelocity</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_angularVelocity</span><span class="ActionScriptBracket/Brace">)</span>;
        
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">impulse</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">m_mass</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">Cdot</span>;
        <span class="ActionScriptDefault_Text">m_impulse</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">impulse</span>;
        
        <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_linearVelocity</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invMass</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">impulse</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_J</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">linearA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
        <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_linearVelocity</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invMass</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">impulse</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_J</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">linearA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
        <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_angularVelocity</span>  <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invI</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">impulse</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_J</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">angularA</span>;
        <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_linearVelocity</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invMass</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">impulse</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_J</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">linearB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
        <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_linearVelocity</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invMass</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">impulse</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_J</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">linearB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
        <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_angularVelocity</span>  <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invI</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">impulse</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_J</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">angularB</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    
    <span class="ActionScriptDefault_Text">b2internal</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">SolvePositionConstraints</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">baumgarte</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Boolean</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptComment">//B2_NOT_USED(baumgarte);
</span>        
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">linearError</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0.0;
        
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bA</span>:<span class="ActionScriptDefault_Text">b2Body</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_bodyA</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bB</span>:<span class="ActionScriptDefault_Text">b2Body</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_bodyB</span>;
        
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">coordinate1</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">coordinate2</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_revolute1</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">coordinate1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_revolute1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">GetJointAngle</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">else</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">coordinate1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_prismatic1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">GetJointTranslation</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_revolute2</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">coordinate2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_revolute2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">GetJointAngle</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">else</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">coordinate2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_prismatic2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">GetJointTranslation</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">C</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_constant</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">coordinate1</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">m_ratio</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">coordinate2</span><span class="ActionScriptBracket/Brace">)</span>;
        
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">impulse</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">m_mass</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">C</span>;
        
        <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_sweep</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invMass</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">impulse</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_J</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">linearA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
        <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_sweep</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invMass</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">impulse</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_J</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">linearA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
        <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_sweep</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">a</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invI</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">impulse</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_J</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">angularA</span>;
        <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_sweep</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invMass</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">impulse</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_J</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">linearB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
        <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_sweep</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invMass</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">impulse</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_J</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">linearB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
        <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_sweep</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">a</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invI</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">impulse</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_J</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">angularB</span>;
        
        <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SynchronizeTransform</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SynchronizeTransform</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        
        <span class="ActionScriptComment">// TODO_ERIN not implemented
</span>        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">linearError</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">b2Settings</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">b2_linearSlop</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m_ground1</span>:<span class="ActionScriptDefault_Text">b2Body</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m_ground2</span>:<span class="ActionScriptDefault_Text">b2Body</span>;

    <span class="ActionScriptComment">// One of these is NULL.
</span>    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m_revolute1</span>:<span class="ActionScriptDefault_Text">b2RevoluteJoint</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m_prismatic1</span>:<span class="ActionScriptDefault_Text">b2PrismaticJoint</span>;

    <span class="ActionScriptComment">// One of these is NULL.
</span>    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m_revolute2</span>:<span class="ActionScriptDefault_Text">b2RevoluteJoint</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m_prismatic2</span>:<span class="ActionScriptDefault_Text">b2PrismaticJoint</span>;

    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m_groundAnchor1</span>:<span class="ActionScriptDefault_Text">b2Vec2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m_groundAnchor2</span>:<span class="ActionScriptDefault_Text">b2Vec2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;

    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m_localAnchor1</span>:<span class="ActionScriptDefault_Text">b2Vec2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m_localAnchor2</span>:<span class="ActionScriptDefault_Text">b2Vec2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;

    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m_J</span>:<span class="ActionScriptDefault_Text">b2Jacobian</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">b2Jacobian</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;

    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m_constant</span>:<span class="ActionScriptDefault_Text">Number</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m_ratio</span>:<span class="ActionScriptDefault_Text">Number</span>;

    <span class="ActionScriptComment">// Effective mass
</span>    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m_mass</span>:<span class="ActionScriptDefault_Text">Number</span>;

    <span class="ActionScriptComment">// Impulse for accumulation/warm starting.
</span>    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m_impulse</span>:<span class="ActionScriptDefault_Text">Number</span>;
<span class="ActionScriptBracket/Brace">}</span>;


<span class="ActionScriptBracket/Brace">}</span></pre></body>
</html>
