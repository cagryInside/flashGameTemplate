<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>b2LineJoint.as</title>
<link rel="stylesheet" type="text/css" href="../../../../../../SourceStyles.css"/>
</head>

<body><pre><span class="ActionScriptComment">/*
* Copyright (c) 2006-2007 Erin Catto http://www.gphysics.com
*
* This software is provided 'as-is', without any express or implied
* warranty.  In no event will the authors be held liable for any damages
* arising from the use of this software.
* Permission is granted to anyone to use this software for any purpose,
* including commercial applications, and to alter it and redistribute it
* freely, subject to the following restrictions:
* 1. The origin of this software must not be misrepresented; you must not
* claim that you wrote the original software. If you use this software
* in a product, an acknowledgment in the product documentation would be
* appreciated but is not required.
* 2. Altered source versions must be plainly marked as such, and must not be
* misrepresented as being the original software.
* 3. This notice may not be removed or altered from any source distribution.
*/</span>

<span class="ActionScriptpackage">package</span> <span class="ActionScriptDefault_Text">Box2D</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Dynamics</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Joints</span><span class="ActionScriptBracket/Brace">{</span>


<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">Box2D</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Common</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">*</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">Box2D</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Common</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">*</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">Box2D</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Dynamics</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">*</span>;

<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">Box2D</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Common</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">b2internal</span>;
<span class="ActionScriptReserved">use</span> <span class="ActionScriptReserved">namespace</span> <span class="ActionScriptDefault_Text">b2internal</span>;

<span class="ActionScriptComment">// Linear constraint (point-to-line)
</span><span class="ActionScriptComment">// d = p2 - p1 = x2 + r2 - x1 - r1
</span><span class="ActionScriptComment">// C = dot(perp, d)
</span><span class="ActionScriptComment">// Cdot = dot(d, cross(w1, perp)) + dot(perp, v2 + cross(w2, r2) - v1 - cross(w1, r1))
</span><span class="ActionScriptComment">//      = -dot(perp, v1) - dot(cross(d + r1, perp), w1) + dot(perp, v2) + dot(cross(r2, perp), v2)
</span><span class="ActionScriptComment">// J = [-perp, -cross(d + r1, perp), perp, cross(r2,perp)]
</span><span class="ActionScriptComment">//
</span><span class="ActionScriptComment">// K = J * invM * JT
</span><span class="ActionScriptComment">//
</span><span class="ActionScriptComment">// J = [-a -s1 a s2]
</span><span class="ActionScriptComment">// a = perp
</span><span class="ActionScriptComment">// s1 = cross(d + r1, a) = cross(p2 - x1, a)
</span><span class="ActionScriptComment">// s2 = cross(r2, a) = cross(p2 - x2, a)
</span>

<span class="ActionScriptComment">// Motor/Limit linear constraint
</span><span class="ActionScriptComment">// C = dot(ax1, d)
</span><span class="ActionScriptComment">// Cdot = = -dot(ax1, v1) - dot(cross(d + r1, ax1), w1) + dot(ax1, v2) + dot(cross(r2, ax1), v2)
</span><span class="ActionScriptComment">// J = [-ax1 -cross(d+r1,ax1) ax1 cross(r2,ax1)]
</span>
<span class="ActionScriptComment">// Block Solver
</span><span class="ActionScriptComment">// We develop a block solver that includes the joint limit. This makes the limit stiff (inelastic) even
</span><span class="ActionScriptComment">// when the mass has poor distribution (leading to large torques about the joint anchor points).
</span><span class="ActionScriptComment">//
</span><span class="ActionScriptComment">// The Jacobian has 3 rows:
</span><span class="ActionScriptComment">// J = [-uT -s1 uT s2] // linear
</span><span class="ActionScriptComment">//     [-vT -a1 vT a2] // limit
</span><span class="ActionScriptComment">//
</span><span class="ActionScriptComment">// u = perp
</span><span class="ActionScriptComment">// v = axis
</span><span class="ActionScriptComment">// s1 = cross(d + r1, u), s2 = cross(r2, u)
</span><span class="ActionScriptComment">// a1 = cross(d + r1, v), a2 = cross(r2, v)
</span>
<span class="ActionScriptComment">// M * (v2 - v1) = JT * df
</span><span class="ActionScriptComment">// J * v2 = bias
</span><span class="ActionScriptComment">//
</span><span class="ActionScriptComment">// v2 = v1 + invM * JT * df
</span><span class="ActionScriptComment">// J * (v1 + invM * JT * df) = bias
</span><span class="ActionScriptComment">// K * df = bias - J * v1 = -Cdot
</span><span class="ActionScriptComment">// K = J * invM * JT
</span><span class="ActionScriptComment">// Cdot = J * v1 - bias
</span><span class="ActionScriptComment">//
</span><span class="ActionScriptComment">// Now solve for f2.
</span><span class="ActionScriptComment">// df = f2 - f1
</span><span class="ActionScriptComment">// K * (f2 - f1) = -Cdot
</span><span class="ActionScriptComment">// f2 = invK * (-Cdot) + f1
</span><span class="ActionScriptComment">//
</span><span class="ActionScriptComment">// Clamp accumulated limit impulse.
</span><span class="ActionScriptComment">// lower: f2(2) = max(f2(2), 0)
</span><span class="ActionScriptComment">// upper: f2(2) = min(f2(2), 0)
</span><span class="ActionScriptComment">//
</span><span class="ActionScriptComment">// Solve for correct f2(1)
</span><span class="ActionScriptComment">// K(1,1) * f2(1) = -Cdot(1) - K(1,2) * f2(2) + K(1,1:2) * f1
</span><span class="ActionScriptComment">//                = -Cdot(1) - K(1,2) * f2(2) + K(1,1) * f1(1) + K(1,2) * f1(2)
</span><span class="ActionScriptComment">// K(1,1) * f2(1) = -Cdot(1) - K(1,2) * (f2(2) - f1(2)) + K(1,1) * f1(1)
</span><span class="ActionScriptComment">// f2(1) = invK(1,1) * (-Cdot(1) - K(1,2) * (f2(2) - f1(2))) + f1(1)
</span><span class="ActionScriptComment">//
</span><span class="ActionScriptComment">// Now compute impulse to be applied:
</span><span class="ActionScriptComment">// df = f2 - f1
</span>
<span class="ActionScriptASDoc">/**
 * A line joint. This joint provides one degree of freedom: translation
 * along an axis fixed in body1. You can use a joint limit to restrict
 * the range of motion and a joint motor to drive the motion or to
 * model joint friction.
 * @see b2LineJointDef
 */</span>
<span class="ActionScriptReserved">public</span> <span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">b2LineJoint</span> <span class="ActionScriptReserved">extends</span> <span class="ActionScriptDefault_Text">b2Joint</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptASDoc">/** @inheritDoc */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">GetAnchorA</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">m_bodyA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">GetWorldPoint</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_localAnchor1</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptASDoc">/** @inheritDoc */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">GetAnchorB</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">m_bodyB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">GetWorldPoint</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_localAnchor2</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptASDoc">/** @inheritDoc */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">GetReactionForce</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">inv_dt</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptDefault_Text">b2Vec2</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptComment">//return inv_dt * (m_impulse.x * m_perp + (m_motorImpulse + m_impulse.y) * m_axis);
</span>        <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">(</span>    <span class="ActionScriptDefault_Text">inv_dt</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_impulse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_perp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_motorImpulse</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">m_impulse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_axis</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">,</span>
                            <span class="ActionScriptDefault_Text">inv_dt</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_impulse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_perp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_motorImpulse</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">m_impulse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_axis</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptASDoc">/** @inheritDoc */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">GetReactionTorque</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">inv_dt</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptDefault_Text">Number</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">inv_dt</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_impulse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    
    <span class="ActionScriptASDoc">/**
    * Get the current joint translation, usually in meters.
    */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">GetJointTranslation</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bA</span>:<span class="ActionScriptDefault_Text">b2Body</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_bodyA</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bB</span>:<span class="ActionScriptDefault_Text">b2Body</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_bodyB</span>;
        
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tMat</span>:<span class="ActionScriptDefault_Text">b2Mat22</span>;
        
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">p1</span>:<span class="ActionScriptDefault_Text">b2Vec2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">GetWorldPoint</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_localAnchor1</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">p2</span>:<span class="ActionScriptDefault_Text">b2Vec2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">GetWorldPoint</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_localAnchor2</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptComment">//var d:b2Vec2 = b2Math.SubtractVV(p2, p1);
</span>        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">p1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dY</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">p1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
        <span class="ActionScriptComment">//b2Vec2 axis = bA-&gt;GetWorldVector(m_localXAxis1);
</span>        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">axis</span>:<span class="ActionScriptDefault_Text">b2Vec2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">GetWorldVector</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_localXAxis1</span><span class="ActionScriptBracket/Brace">)</span>;
        
        <span class="ActionScriptComment">//float32 translation = b2Dot(d, axis);
</span>        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">translation</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">axis</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">dX</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">axis</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">dY</span>;
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">translation</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    
    <span class="ActionScriptASDoc">/**
    * Get the current joint translation speed, usually in meters per second.
    */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">GetJointSpeed</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bA</span>:<span class="ActionScriptDefault_Text">b2Body</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_bodyA</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bB</span>:<span class="ActionScriptDefault_Text">b2Body</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_bodyB</span>;
        
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tMat</span>:<span class="ActionScriptDefault_Text">b2Mat22</span>;
        
        <span class="ActionScriptComment">//b2Vec2 r1 = b2Mul(bA-&gt;m_xf.R, m_localAnchor1 - bA-&gt;GetLocalCenter());
</span>        <span class="ActionScriptDefault_Text">tMat</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_xf</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">R</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">r1X</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_localAnchor1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_sweep</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">localCenter</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">r1Y</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_localAnchor1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_sweep</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">localCenter</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span>  <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">r1X</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">r1Y</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">r1Y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">r1X</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">r1Y</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">r1X</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tX</span>;
        <span class="ActionScriptComment">//b2Vec2 r2 = b2Mul(bB-&gt;m_xf.R, m_localAnchor2 - bB-&gt;GetLocalCenter());
</span>        <span class="ActionScriptDefault_Text">tMat</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_xf</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">R</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">r2X</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_localAnchor2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_sweep</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">localCenter</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">r2Y</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_localAnchor2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_sweep</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">localCenter</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
        <span class="ActionScriptDefault_Text">tX</span> <span class="ActionScriptOperator">=</span>  <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">r2X</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">r2Y</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">r2Y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">r2X</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">r2Y</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">r2X</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tX</span>;
        
        <span class="ActionScriptComment">//b2Vec2 p1 = bA-&gt;m_sweep.c + r1;
</span>        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">p1X</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_sweep</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">r1X</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">p1Y</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_sweep</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">r1Y</span>;
        <span class="ActionScriptComment">//b2Vec2 p2 = bB-&gt;m_sweep.c + r2;
</span>        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">p2X</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_sweep</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">r2X</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">p2Y</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_sweep</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">r2Y</span>;
        <span class="ActionScriptComment">//var d:b2Vec2 = b2Math.SubtractVV(p2, p1);
</span>        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p2X</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">p1X</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dY</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">p2Y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">p1Y</span>;
        <span class="ActionScriptComment">//b2Vec2 axis = bA-&gt;GetWorldVector(m_localXAxis1);
</span>        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">axis</span>:<span class="ActionScriptDefault_Text">b2Vec2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">GetWorldVector</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_localXAxis1</span><span class="ActionScriptBracket/Brace">)</span>;
        
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">v1</span>:<span class="ActionScriptDefault_Text">b2Vec2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_linearVelocity</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">v2</span>:<span class="ActionScriptDefault_Text">b2Vec2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_linearVelocity</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">w1</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_angularVelocity</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">w2</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_angularVelocity</span>;
        
        <span class="ActionScriptComment">//var speed:Number = b2Math.b2Dot(d, b2Math.b2CrossFV(w1, ax1)) + b2Math.b2Dot(ax1, b2Math.SubtractVV( b2Math.SubtractVV( b2Math.AddVV( v2 , b2Math.b2CrossFV(w2, r2)) , v1) , b2Math.b2CrossFV(w1, r1)));
</span>        <span class="ActionScriptComment">//var b2D:Number = (dX*(-w1 * ax1Y) + dY*(w1 * ax1X));
</span>        <span class="ActionScriptComment">//var b2D2:Number = (ax1X * ((( v2.x + (-w2 * r2Y)) - v1.x) - (-w1 * r1Y)) + ax1Y * ((( v2.y + (w2 * r2X)) - v1.y) - (w1 * r1X)));
</span>        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">speed</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dX</span><span class="ActionScriptOperator">*</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">w1</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">axis</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">dY</span><span class="ActionScriptOperator">*</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">w1</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">axis</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">axis</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">v2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">w2</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">r2Y</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">v1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">w1</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">r1Y</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">axis</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">v2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">w2</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">r2X</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">v1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">w1</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">r1X</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
        
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">speed</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    
    <span class="ActionScriptASDoc">/**
    * Is the joint limit enabled?
    */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">IsLimitEnabled</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptDefault_Text">Boolean</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">m_enableLimit</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptASDoc">/**
    * Enable/disable the joint limit.
    */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">EnableLimit</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">flag</span>:<span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">m_bodyA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetAwake</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">m_bodyB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetAwake</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">m_enableLimit</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">flag</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptASDoc">/**
    * Get the lower joint limit, usually in meters.
    */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">GetLowerLimit</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptDefault_Text">Number</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">m_lowerTranslation</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptASDoc">/**
    * Get the upper joint limit, usually in meters.
    */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">GetUpperLimit</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptDefault_Text">Number</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">m_upperTranslation</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptASDoc">/**
    * Set the joint limits, usually in meters.
    */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">SetLimits</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lower</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">upper</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptComment">//b2Settings.b2Assert(lower &lt;= upper);
</span>        <span class="ActionScriptDefault_Text">m_bodyA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetAwake</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">m_bodyB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetAwake</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">m_lowerTranslation</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">lower</span>;
        <span class="ActionScriptDefault_Text">m_upperTranslation</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">upper</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptASDoc">/**
    * Is the joint motor enabled?
    */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">IsMotorEnabled</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptDefault_Text">Boolean</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">m_enableMotor</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptASDoc">/**
    * Enable/disable the joint motor.
    */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">EnableMotor</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">flag</span>:<span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">m_bodyA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetAwake</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">m_bodyB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetAwake</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">m_enableMotor</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">flag</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptASDoc">/**
    * Set the motor speed, usually in meters per second.
    */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">SetMotorSpeed</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">speed</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">m_bodyA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetAwake</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">m_bodyB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetAwake</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">m_motorSpeed</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">speed</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptASDoc">/**
    * Get the motor speed, usually in meters per second.
    */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">GetMotorSpeed</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> :<span class="ActionScriptDefault_Text">Number</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">m_motorSpeed</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    
    <span class="ActionScriptASDoc">/**
     * Set the maximum motor force, usually in N.
     */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">SetMaxMotorForce</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">force</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">m_bodyA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetAwake</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">m_bodyB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetAwake</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">m_maxMotorForce</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">force</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    
    <span class="ActionScriptASDoc">/**
     * Get the maximum motor force, usually in N.
     */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">GetMaxMotorForce</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Number</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">m_maxMotorForce</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    
    <span class="ActionScriptASDoc">/**
    * Get the current motor force, usually in N.
    */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">GetMotorForce</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptDefault_Text">Number</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">m_motorImpulse</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    

    <span class="ActionScriptComment">//--------------- Internals Below -------------------
</span>
    <span class="ActionScriptASDoc">/** @private */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">b2LineJoint</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">def</span>:<span class="ActionScriptDefault_Text">b2LineJointDef</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">super</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">def</span><span class="ActionScriptBracket/Brace">)</span>;
        
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tMat</span>:<span class="ActionScriptDefault_Text">b2Mat22</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tX</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tY</span>:<span class="ActionScriptDefault_Text">Number</span>;
        
        <span class="ActionScriptDefault_Text">m_localAnchor1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetV</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">def</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">localAnchorA</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">m_localAnchor2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetV</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">def</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">localAnchorB</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">m_localXAxis1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetV</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">def</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">localAxisA</span><span class="ActionScriptBracket/Brace">)</span>;
        
        <span class="ActionScriptComment">//m_localYAxis1 = b2Cross(1.0f, m_localXAxis1);
</span>        <span class="ActionScriptDefault_Text">m_localYAxis1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">m_localXAxis1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
        <span class="ActionScriptDefault_Text">m_localYAxis1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_localXAxis1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
        
        <span class="ActionScriptDefault_Text">m_impulse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetZero</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">m_motorMass</span> <span class="ActionScriptOperator">=</span> 0.0;
        <span class="ActionScriptDefault_Text">m_motorImpulse</span> <span class="ActionScriptOperator">=</span> 0.0;
        
        <span class="ActionScriptDefault_Text">m_lowerTranslation</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">def</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">lowerTranslation</span>;
        <span class="ActionScriptDefault_Text">m_upperTranslation</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">def</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">upperTranslation</span>;
        <span class="ActionScriptDefault_Text">m_maxMotorForce</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">def</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">maxMotorForce</span>;
        <span class="ActionScriptDefault_Text">m_motorSpeed</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">def</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">motorSpeed</span>;
        <span class="ActionScriptDefault_Text">m_enableLimit</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">def</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">enableLimit</span>;
        <span class="ActionScriptDefault_Text">m_enableMotor</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">def</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">enableMotor</span>;
        <span class="ActionScriptDefault_Text">m_limitState</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">e_inactiveLimit</span>;
        
        <span class="ActionScriptDefault_Text">m_axis</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetZero</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">m_perp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetZero</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptDefault_Text">b2internal</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">InitVelocityConstraints</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">step</span>:<span class="ActionScriptDefault_Text">b2TimeStep</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span><span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bA</span>:<span class="ActionScriptDefault_Text">b2Body</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_bodyA</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bB</span>:<span class="ActionScriptDefault_Text">b2Body</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_bodyB</span>;
        
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tMat</span>:<span class="ActionScriptDefault_Text">b2Mat22</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tX</span>:<span class="ActionScriptDefault_Text">Number</span>;
        
        <span class="ActionScriptDefault_Text">m_localCenterA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetV</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">GetLocalCenter</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">m_localCenterB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetV</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">GetLocalCenter</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
        
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">xf1</span>:<span class="ActionScriptDefault_Text">b2Transform</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">GetTransform</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">xf2</span>:<span class="ActionScriptDefault_Text">b2Transform</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">GetTransform</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        
        <span class="ActionScriptComment">// Compute the effective masses.
</span>        <span class="ActionScriptComment">//b2Vec2 r1 = b2Mul(bA-&gt;m_xf.R, m_localAnchor1 - bA-&gt;GetLocalCenter());
</span>        <span class="ActionScriptDefault_Text">tMat</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_xf</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">R</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">r1X</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_localAnchor1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">m_localCenterA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">r1Y</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_localAnchor1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">m_localCenterA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
        <span class="ActionScriptDefault_Text">tX</span> <span class="ActionScriptOperator">=</span>  <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">r1X</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">r1Y</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">r1Y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">r1X</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">r1Y</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">r1X</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tX</span>;
        <span class="ActionScriptComment">//b2Vec2 r2 = b2Mul(bB-&gt;m_xf.R, m_localAnchor2 - bB-&gt;GetLocalCenter());
</span>        <span class="ActionScriptDefault_Text">tMat</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_xf</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">R</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">r2X</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_localAnchor2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">m_localCenterB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">r2Y</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_localAnchor2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">m_localCenterB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
        <span class="ActionScriptDefault_Text">tX</span> <span class="ActionScriptOperator">=</span>  <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">r2X</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">r2Y</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">r2Y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">r2X</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">r2Y</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">r2X</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tX</span>;
        
        <span class="ActionScriptComment">//b2Vec2 d = bB-&gt;m_sweep.c + r2 - bA-&gt;m_sweep.c - r1;
</span>        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_sweep</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">r2X</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_sweep</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">r1X</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dY</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_sweep</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">r2Y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_sweep</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">r1Y</span>;
        
        <span class="ActionScriptDefault_Text">m_invMassA</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invMass</span>;
        <span class="ActionScriptDefault_Text">m_invMassB</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invMass</span>;
        <span class="ActionScriptDefault_Text">m_invIA</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invI</span>;
        <span class="ActionScriptDefault_Text">m_invIB</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_invI</span>;
        
        <span class="ActionScriptComment">// Compute motor Jacobian and effective mass.
</span>        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">m_axis</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetV</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">b2Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MulMV</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">xf1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">R</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">m_localXAxis1</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptComment">//m_a1 = b2Math.b2Cross(d + r1, m_axis);
</span>            <span class="ActionScriptDefault_Text">m_a1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dX</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">r1X</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_axis</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dY</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">r1Y</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_axis</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
            <span class="ActionScriptComment">//m_a2 = b2Math.b2Cross(r2, m_axis);
</span>            <span class="ActionScriptDefault_Text">m_a2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">r2X</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_axis</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">r2Y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_axis</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
            
            <span class="ActionScriptDefault_Text">m_motorMass</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_invMassA</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">m_invMassB</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">m_invIA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_a1</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_a1</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">m_invIB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_a2</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_a2</span>; 
            <span class="ActionScriptDefault_Text">m_motorMass</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_motorMass</span> <span class="ActionScriptOperator">&gt;</span> <span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MIN_VALUE</span><span class="ActionScriptOperator">?</span>1.0 <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">m_motorMass</span>:0.0;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptComment">// Prismatic constraint.
</span>        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">m_perp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetV</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">b2Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MulMV</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">xf1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">R</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">m_localYAxis1</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptComment">//m_s1 = b2Math.b2Cross(d + r1, m_perp);
</span>            <span class="ActionScriptDefault_Text">m_s1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dX</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">r1X</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_perp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dY</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">r1Y</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_perp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
            <span class="ActionScriptComment">//m_s2 = b2Math.b2Cross(r2, m_perp);
</span>            <span class="ActionScriptDefault_Text">m_s2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">r2X</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_perp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">r2Y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_perp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m1</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_invMassA</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m2</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_invMassB</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i1</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_invIA</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i2</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_invIB</span>;
            
            <span class="ActionScriptDefault_Text">m_K</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m1</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">m2</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">i1</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_s1</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_s1</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">i2</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_s2</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_s2</span>;
                 <span class="ActionScriptDefault_Text">m_K</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i1</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_s1</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_a1</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">i2</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_s2</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_a2</span>;
            <span class="ActionScriptDefault_Text">m_K</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_K</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
                 <span class="ActionScriptDefault_Text">m_K</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m1</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">m2</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">i1</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_a1</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_a1</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">i2</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_a2</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_a2</span>; 
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptComment">// Compute motor and limit terms
</span>        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_enableLimit</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">//float32 jointTranslation = b2Dot(m_axis, d); 
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">jointTransition</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_axis</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">dX</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">m_axis</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">dY</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">b2Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Abs</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_upperTranslation</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">m_lowerTranslation</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&lt;</span> 2.0 <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">b2Settings</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">b2_linearSlop</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">m_limitState</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">e_equalLimits</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">jointTransition</span> <span class="ActionScriptOperator">&lt;=</span> <span class="ActionScriptDefault_Text">m_lowerTranslation</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_limitState</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">e_atLowerLimit</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">m_limitState</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">e_atLowerLimit</span>;
                    <span class="ActionScriptDefault_Text">m_impulse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> 0.0;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">jointTransition</span> <span class="ActionScriptOperator">&gt;=</span> <span class="ActionScriptDefault_Text">m_upperTranslation</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_limitState</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">e_atUpperLimit</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">m_limitState</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">e_atUpperLimit</span>;
                    <span class="ActionScriptDefault_Text">m_impulse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> 0.0;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">m_limitState</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">e_inactiveLimit</span>;
                <span class="ActionScriptDefault_Text">m_impulse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> 0.0;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">else</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">m_limitState</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">e_inactiveLimit</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_enableMotor</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">m_motorImpulse</span> <span class="ActionScriptOperator">=</span> 0.0
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">step</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">warmStarting</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">// Account for variable time step.
</span>            <span class="ActionScriptDefault_Text">m_impulse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*=</span> <span class="ActionScriptDefault_Text">step</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dtRatio</span>;
            <span class="ActionScriptDefault_Text">m_impulse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*=</span> <span class="ActionScriptDefault_Text">step</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dtRatio</span>;
            <span class="ActionScriptDefault_Text">m_motorImpulse</span> <span class="ActionScriptOperator">*=</span> <span class="ActionScriptDefault_Text">step</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dtRatio</span>; 
            
            <span class="ActionScriptComment">//b2Vec2 P = m_impulse.x * m_perp + (m_motorImpulse + m_impulse.z) * m_axis;
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">PX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_impulse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_perp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_motorImpulse</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">m_impulse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_axis</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">PY</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_impulse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_perp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_motorImpulse</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">m_impulse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_axis</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">L1</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_impulse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_s1</span>     <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_motorImpulse</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">m_impulse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_a1</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">L2</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_impulse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_s2</span>     <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_motorImpulse</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">m_impulse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_a2</span>; 

            <span class="ActionScriptComment">//bA-&gt;m_linearVelocity -= m_invMassA * P;
</span>            <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_linearVelocity</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">m_invMassA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PX</span>;
            <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_linearVelocity</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">m_invMassA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PY</span>;
            <span class="ActionScriptComment">//bA-&gt;m_angularVelocity -= m_invIA * L1;
</span>            <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_angularVelocity</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">m_invIA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">L1</span>;
            
            <span class="ActionScriptComment">//bB-&gt;m_linearVelocity += m_invMassB * P;
</span>            <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_linearVelocity</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">m_invMassB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PX</span>;
            <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_linearVelocity</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">m_invMassB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PY</span>;
            <span class="ActionScriptComment">//bB-&gt;m_angularVelocity += m_invIB * L2;
</span>            <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_angularVelocity</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">m_invIB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">L2</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">else</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">m_impulse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetZero</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">m_motorImpulse</span> <span class="ActionScriptOperator">=</span> 0.0;
        <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>
    
    <span class="ActionScriptDefault_Text">b2internal</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">SolveVelocityConstraints</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">step</span>:<span class="ActionScriptDefault_Text">b2TimeStep</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptReserved">void</span><span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bA</span>:<span class="ActionScriptDefault_Text">b2Body</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_bodyA</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bB</span>:<span class="ActionScriptDefault_Text">b2Body</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_bodyB</span>;
        
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">v1</span>:<span class="ActionScriptDefault_Text">b2Vec2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_linearVelocity</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">w1</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_angularVelocity</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">v2</span>:<span class="ActionScriptDefault_Text">b2Vec2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_linearVelocity</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">w2</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_angularVelocity</span>;
        
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">PX</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">PY</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">L1</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">L2</span>:<span class="ActionScriptDefault_Text">Number</span>;
        
        <span class="ActionScriptComment">// Solve linear motor constraint
</span>        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_enableMotor</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">m_limitState</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">e_equalLimits</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">//float32 Cdot = b2Dot(m_axis, v2 - v1) + m_a2 * w2 - m_a1 * w1; 
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">Cdot</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_axis</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">v1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">m_axis</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">v1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">m_a2</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">w2</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">m_a1</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">w1</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">impulse</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_motorMass</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_motorSpeed</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">Cdot</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">oldImpulse</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_motorImpulse</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">maxImpulse</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">step</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dt</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_maxMotorForce</span>;
            <span class="ActionScriptDefault_Text">m_motorImpulse</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">b2Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Clamp</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_motorImpulse</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">impulse</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">maxImpulse</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">maxImpulse</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">impulse</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_motorImpulse</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">oldImpulse</span>;
            
            <span class="ActionScriptDefault_Text">PX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">impulse</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_axis</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
            <span class="ActionScriptDefault_Text">PY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">impulse</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_axis</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
            <span class="ActionScriptDefault_Text">L1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">impulse</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_a1</span>;
            <span class="ActionScriptDefault_Text">L2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">impulse</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_a2</span>;
            
            <span class="ActionScriptDefault_Text">v1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">m_invMassA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PX</span>;
            <span class="ActionScriptDefault_Text">v1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">m_invMassA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PY</span>;
            <span class="ActionScriptDefault_Text">w1</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">m_invIA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">L1</span>;
            
            <span class="ActionScriptDefault_Text">v2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">m_invMassB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PX</span>;
            <span class="ActionScriptDefault_Text">v2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">m_invMassB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PY</span>;
            <span class="ActionScriptDefault_Text">w2</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">m_invIB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">L2</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptComment">//Cdot1 = b2Dot(m_perp, v2 - v1) + m_s2 * w2 - m_s1 * w1; 
</span>        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">Cdot1</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_perp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">v1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">m_perp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">v1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">m_s2</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">w2</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">m_s1</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">w1</span>; 
        
        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_enableLimit</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">m_limitState</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">e_inactiveLimit</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">// Solve prismatic and limit constraint in block form
</span>            <span class="ActionScriptComment">//Cdot2 = b2Dot(m_axis, v2 - v1) + m_a2 * w2 - m_a1 * w1; 
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">Cdot2</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_axis</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">v1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">m_axis</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">v1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">m_a2</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">w2</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">m_a1</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">w1</span>; 
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">f1</span>:<span class="ActionScriptDefault_Text">b2Vec2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_impulse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Copy</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">df</span>:<span class="ActionScriptDefault_Text">b2Vec2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_K</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Solve</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">Cdot1</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">Cdot2</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">m_impulse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Add</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">df</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_limitState</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">e_atLowerLimit</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">m_impulse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">b2Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Max</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_impulse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptOperator">,</span> 0.0<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_limitState</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">e_atUpperLimit</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">m_impulse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">b2Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Min</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_impulse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptOperator">,</span> 0.0<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">// f2(1) = invK(1,1) * (-Cdot(1) - K(1,3) * (f2(2) - f1(2))) + f1(1) 
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">b</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">Cdot1</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_impulse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">f1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_K</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">f2r</span>:<span class="ActionScriptDefault_Text">Number</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_K</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">!=</span> 0.0<span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">f2r</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">b</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">m_K</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">f1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
            <span class="ActionScriptBracket/Brace">}</span><span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">f2r</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">f1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptDefault_Text">m_impulse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">f2r</span>;
            
            <span class="ActionScriptDefault_Text">df</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_impulse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">f1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
            <span class="ActionScriptDefault_Text">df</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_impulse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">f1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
            
            <span class="ActionScriptDefault_Text">PX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">df</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_perp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">df</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_axis</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
            <span class="ActionScriptDefault_Text">PY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">df</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_perp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">df</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_axis</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
            <span class="ActionScriptDefault_Text">L1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">df</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_s1</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">df</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_a1</span>;
            <span class="ActionScriptDefault_Text">L2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">df</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_s2</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">df</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_a2</span>;
            
            <span class="ActionScriptDefault_Text">v1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">m_invMassA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PX</span>;
            <span class="ActionScriptDefault_Text">v1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">m_invMassA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PY</span>;
            <span class="ActionScriptDefault_Text">w1</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">m_invIA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">L1</span>;
            
            <span class="ActionScriptDefault_Text">v2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">m_invMassB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PX</span>;
            <span class="ActionScriptDefault_Text">v2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">m_invMassB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PY</span>;
            <span class="ActionScriptDefault_Text">w2</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">m_invIB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">L2</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">else</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">// Limit is inactive, just solve the prismatic constraint in block form. 
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">df2</span>:<span class="ActionScriptDefault_Text">Number</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_K</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">!=</span> 0.0<span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">df2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">Cdot1</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">m_K</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
            <span class="ActionScriptBracket/Brace">}</span><span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">df2</span> <span class="ActionScriptOperator">=</span> 0.0;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptDefault_Text">m_impulse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">df2</span>;
            
            <span class="ActionScriptDefault_Text">PX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">df2</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_perp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
            <span class="ActionScriptDefault_Text">PY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">df2</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_perp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
            <span class="ActionScriptDefault_Text">L1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">df2</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_s1</span>;
            <span class="ActionScriptDefault_Text">L2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">df2</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_s2</span>;
            
            <span class="ActionScriptDefault_Text">v1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">m_invMassA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PX</span>;
            <span class="ActionScriptDefault_Text">v1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">m_invMassA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PY</span>;
            <span class="ActionScriptDefault_Text">w1</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">m_invIA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">L1</span>;
            
            <span class="ActionScriptDefault_Text">v2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">m_invMassB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PX</span>;
            <span class="ActionScriptDefault_Text">v2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">m_invMassB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PY</span>;
            <span class="ActionScriptDefault_Text">w2</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">m_invIB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">L2</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_linearVelocity</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetV</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v1</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_angularVelocity</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">w1</span>;
        <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_linearVelocity</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetV</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v2</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_angularVelocity</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">w2</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    
    <span class="ActionScriptDefault_Text">b2internal</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">SolvePositionConstraints</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">baumgarte</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Boolean</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptComment">//B2_NOT_USED(baumgarte);
</span>        
        
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">limitC</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">oldLimitImpulse</span>:<span class="ActionScriptDefault_Text">Number</span>;
        
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bA</span>:<span class="ActionScriptDefault_Text">b2Body</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_bodyA</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bB</span>:<span class="ActionScriptDefault_Text">b2Body</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_bodyB</span>;
        
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">c1</span>:<span class="ActionScriptDefault_Text">b2Vec2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_sweep</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">c</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">a1</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_sweep</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">a</span>;
        
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">c2</span>:<span class="ActionScriptDefault_Text">b2Vec2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_sweep</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">c</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">a2</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_sweep</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">a</span>;
        
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tMat</span>:<span class="ActionScriptDefault_Text">b2Mat22</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tX</span>:<span class="ActionScriptDefault_Text">Number</span>;
        
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m1</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m2</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i1</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i2</span>:<span class="ActionScriptDefault_Text">Number</span>;
        
        <span class="ActionScriptComment">// Solve linear limit constraint
</span>        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">linearError</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0.0;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">angularError</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0.0;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">active</span>:<span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">C2</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0.0;
        
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">R1</span>:<span class="ActionScriptDefault_Text">b2Mat22</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">b2Mat22</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">FromAngle</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">a1</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">R2</span>:<span class="ActionScriptDefault_Text">b2Mat22</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">b2Mat22</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">FromAngle</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">a2</span><span class="ActionScriptBracket/Brace">)</span>;
        
        <span class="ActionScriptComment">//b2Vec2 r1 = b2Mul(R1, m_localAnchor1 - m_localCenter1);
</span>        <span class="ActionScriptDefault_Text">tMat</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">R1</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">r1X</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_localAnchor1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">m_localCenterA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">r1Y</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_localAnchor1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">m_localCenterA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
        <span class="ActionScriptDefault_Text">tX</span> <span class="ActionScriptOperator">=</span>  <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">r1X</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">r1Y</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">r1Y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">r1X</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">r1Y</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">r1X</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tX</span>;
        <span class="ActionScriptComment">//b2Vec2 r2 = b2Mul(R2, m_localAnchor2 - m_localCenter2);
</span>        <span class="ActionScriptDefault_Text">tMat</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">R2</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">r2X</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_localAnchor2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">m_localCenterB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">r2Y</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_localAnchor2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">m_localCenterB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
        <span class="ActionScriptDefault_Text">tX</span> <span class="ActionScriptOperator">=</span>  <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">r2X</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">r2Y</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">r2Y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">r2X</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tMat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">r2Y</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">r2X</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tX</span>;
        
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">c2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">r2X</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">c1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">r1X</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dY</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">c2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">r2Y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">c1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">r1Y</span>;
        
        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_enableLimit</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">m_axis</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">b2Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MulMV</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">R1</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">m_localXAxis1</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">//m_a1 = b2Math.b2Cross(d + r1, m_axis);
</span>            <span class="ActionScriptDefault_Text">m_a1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dX</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">r1X</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_axis</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dY</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">r1Y</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_axis</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
            <span class="ActionScriptComment">//m_a2 = b2Math.b2Cross(r2, m_axis);
</span>            <span class="ActionScriptDefault_Text">m_a2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">r2X</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_axis</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">r2Y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_axis</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">translation</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_axis</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">dX</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">m_axis</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">dY</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">b2Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Abs</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m_upperTranslation</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">m_lowerTranslation</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&lt;</span> 2.0 <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">b2Settings</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">b2_linearSlop</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// Prevent large angular corrections.
</span>                <span class="ActionScriptDefault_Text">C2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">b2Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Clamp</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">translation</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">b2Settings</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">b2_maxLinearCorrection</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">b2Settings</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">b2_maxLinearCorrection</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">linearError</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">b2Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Abs</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">translation</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">active</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">translation</span> <span class="ActionScriptOperator">&lt;=</span> <span class="ActionScriptDefault_Text">m_lowerTranslation</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// Prevent large angular corrections and allow some slop.
</span>                <span class="ActionScriptDefault_Text">C2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">b2Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Clamp</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">translation</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">m_lowerTranslation</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">b2Settings</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">b2_linearSlop</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">b2Settings</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">b2_maxLinearCorrection</span><span class="ActionScriptOperator">,</span> 0.0<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">linearError</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_lowerTranslation</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">translation</span>;
                <span class="ActionScriptDefault_Text">active</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">translation</span> <span class="ActionScriptOperator">&gt;=</span> <span class="ActionScriptDefault_Text">m_upperTranslation</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// Prevent large angular corrections and allow some slop.
</span>                <span class="ActionScriptDefault_Text">C2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">b2Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Clamp</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">translation</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">m_upperTranslation</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">b2Settings</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">b2_linearSlop</span><span class="ActionScriptOperator">,</span> 0.0<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">b2Settings</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">b2_maxLinearCorrection</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">linearError</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">translation</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">m_upperTranslation</span>;
                <span class="ActionScriptDefault_Text">active</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptDefault_Text">m_perp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">b2Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MulMV</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">R1</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">m_localYAxis1</span><span class="ActionScriptBracket/Brace">)</span>;
        
        <span class="ActionScriptComment">//m_s1 = b2Cross(d + r1, m_perp); 
</span>        <span class="ActionScriptDefault_Text">m_s1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dX</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">r1X</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_perp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dY</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">r1Y</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_perp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
        <span class="ActionScriptComment">//m_s2 = b2Cross(r2, m_perp); 
</span>        <span class="ActionScriptDefault_Text">m_s2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">r2X</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_perp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">r2Y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_perp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
        
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">impulse</span>:<span class="ActionScriptDefault_Text">b2Vec2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">C1</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_perp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">dX</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">m_perp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">dY</span>;
        
        <span class="ActionScriptDefault_Text">linearError</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">b2Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Max</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">linearError</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">b2Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Abs</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">C1</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">angularError</span> <span class="ActionScriptOperator">=</span> 0.0;
        
        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">active</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">m1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_invMassA</span>;
            <span class="ActionScriptDefault_Text">m2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_invMassB</span>;
            <span class="ActionScriptDefault_Text">i1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_invIA</span>;
            <span class="ActionScriptDefault_Text">i2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_invIB</span>;
            
            <span class="ActionScriptDefault_Text">m_K</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m1</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">m2</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">i1</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_s1</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_s1</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">i2</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_s2</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_s2</span>;
                 <span class="ActionScriptDefault_Text">m_K</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i1</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_s1</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_a1</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">i2</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_s2</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_a2</span>;
            <span class="ActionScriptDefault_Text">m_K</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_K</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
                 <span class="ActionScriptDefault_Text">m_K</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">col2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m1</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">m2</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">i1</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_a1</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_a1</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">i2</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_a2</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_a2</span>;
            
            <span class="ActionScriptDefault_Text">m_K</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Solve</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">impulse</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">C1</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">C2</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">else</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">m1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_invMassA</span>;
            <span class="ActionScriptDefault_Text">m2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_invMassB</span>;
            <span class="ActionScriptDefault_Text">i1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_invIA</span>;
            <span class="ActionScriptDefault_Text">i2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m_invIB</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">k11</span>:<span class="ActionScriptDefault_Text">Number</span>  <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">m1</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">m2</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">i1</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_s1</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_s1</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">i2</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_s2</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_s2</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">impulse1</span>:<span class="ActionScriptDefault_Text">Number</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">k11</span> <span class="ActionScriptOperator">!=</span> 0.0<span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">impulse1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">C1</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">k11</span>;
            <span class="ActionScriptBracket/Brace">}</span><span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">impulse1</span> <span class="ActionScriptOperator">=</span> 0.0;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptDefault_Text">impulse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">impulse1</span>;
            <span class="ActionScriptDefault_Text">impulse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> 0.0;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">PX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">impulse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_perp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">impulse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_axis</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">PY</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">impulse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_perp</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">impulse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_axis</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">L1</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">impulse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_s1</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">impulse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_a1</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">L2</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">impulse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_s2</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">impulse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">m_a2</span>;
        
        <span class="ActionScriptDefault_Text">c1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">m_invMassA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PX</span>;
        <span class="ActionScriptDefault_Text">c1</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">m_invMassA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PY</span>;
        <span class="ActionScriptDefault_Text">a1</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">m_invIA</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">L1</span>;
        
        <span class="ActionScriptDefault_Text">c2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">m_invMassB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PX</span>;
        <span class="ActionScriptDefault_Text">c2</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">m_invMassB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">PY</span>;
        <span class="ActionScriptDefault_Text">a2</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">m_invIB</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">L2</span>;
        
        <span class="ActionScriptComment">// TODO_ERIN remove need for this
</span>        <span class="ActionScriptComment">//bA.m_sweep.c = c1;    //Already done by reference
</span>        <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_sweep</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">a</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">a1</span>;
        <span class="ActionScriptComment">//bB.m_sweep.c = c2;    //Already done by reference
</span>        <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">m_sweep</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">a</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">a2</span>;
        <span class="ActionScriptDefault_Text">bA</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SynchronizeTransform</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">bB</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SynchronizeTransform</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>; 
        
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">linearError</span> <span class="ActionScriptOperator">&lt;=</span> <span class="ActionScriptDefault_Text">b2Settings</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">b2_linearSlop</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">angularError</span> <span class="ActionScriptOperator">&lt;=</span> <span class="ActionScriptDefault_Text">b2Settings</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">b2_angularSlop</span>;
        
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptDefault_Text">b2internal</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m_localAnchor1</span>:<span class="ActionScriptDefault_Text">b2Vec2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptDefault_Text">b2internal</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m_localAnchor2</span>:<span class="ActionScriptDefault_Text">b2Vec2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptDefault_Text">b2internal</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m_localXAxis1</span>:<span class="ActionScriptDefault_Text">b2Vec2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m_localYAxis1</span>:<span class="ActionScriptDefault_Text">b2Vec2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;

    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m_axis</span>:<span class="ActionScriptDefault_Text">b2Vec2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m_perp</span>:<span class="ActionScriptDefault_Text">b2Vec2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m_s1</span>:<span class="ActionScriptDefault_Text">Number</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m_s2</span>:<span class="ActionScriptDefault_Text">Number</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m_a1</span>:<span class="ActionScriptDefault_Text">Number</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m_a2</span>:<span class="ActionScriptDefault_Text">Number</span>;
    
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m_K</span>:<span class="ActionScriptDefault_Text">b2Mat22</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">b2Mat22</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m_impulse</span>:<span class="ActionScriptDefault_Text">b2Vec2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;

    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m_motorMass</span>:<span class="ActionScriptDefault_Text">Number</span>;            <span class="ActionScriptComment">// effective mass for motor/limit translational constraint.
</span>    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m_motorImpulse</span>:<span class="ActionScriptDefault_Text">Number</span>;

    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m_lowerTranslation</span>:<span class="ActionScriptDefault_Text">Number</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m_upperTranslation</span>:<span class="ActionScriptDefault_Text">Number</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m_maxMotorForce</span>:<span class="ActionScriptDefault_Text">Number</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m_motorSpeed</span>:<span class="ActionScriptDefault_Text">Number</span>;
    
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m_enableLimit</span>:<span class="ActionScriptDefault_Text">Boolean</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m_enableMotor</span>:<span class="ActionScriptDefault_Text">Boolean</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m_limitState</span>:<span class="ActionScriptDefault_Text">int</span>;
<span class="ActionScriptBracket/Brace">}</span>;

<span class="ActionScriptBracket/Brace">}</span>
</pre></body>
</html>
